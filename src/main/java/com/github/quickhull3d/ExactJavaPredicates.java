package com.github.quickhull3d;

public class ExactJavaPredicates {

	// from ProGAL

	public enum SphereConfig {
		INSIDE, OUTSIDE, ON, COPLANAR
	};

	public enum PlaneConfig {
		SAME, DIFF, COPLANAR
	};

	static {
		exactinit();
	}

	private ExactJavaPredicates() {
	}

	public static double orient(Vertex p0, Vertex p1, Vertex p2, Vertex q) {
		double orient = orient3d(p0.x(), p0.y(), p0.z(), p1.x(), p1.y(), p1.z(), p2.x(), p2.y(), p2.z(), q.x(), q.y(), q.z());
		return orient;
	}

	private static double splitter;
	private static double epsilon;

	private static double resulterrbound;
	private static double ccwerrboundA, ccwerrboundB, ccwerrboundC;
	private static double o3derrboundA, o3derrboundB, o3derrboundC;
	private static double iccerrboundA, iccerrboundB, iccerrboundC;
	private static double isperrboundA, isperrboundB, isperrboundC;

	private static void exactinit() {
		double half;
		double check, lastcheck;
		int every_other;

		every_other = 1;
		half = 0.5;
		epsilon = 1.0;
		splitter = 1.0;
		check = 1.0;

		do {
			lastcheck = check;
			epsilon *= half;
			if (every_other != 0) {
				splitter *= 2.0;
			}
			every_other = every_other == 0 ? 1 : 0;
			check = 1.0 + epsilon;
		} while ((check != 1.0) && (check != lastcheck));
		splitter += 1.0;

		resulterrbound = (3.0 + 8.0 * epsilon) * epsilon;
		ccwerrboundA = (3.0 + 16.0 * epsilon) * epsilon;
		ccwerrboundB = (2.0 + 12.0 * epsilon) * epsilon;
		ccwerrboundC = (9.0 + 64.0 * epsilon) * epsilon * epsilon;
		o3derrboundA = (7.0 + 56.0 * epsilon) * epsilon;
		o3derrboundB = (3.0 + 28.0 * epsilon) * epsilon;
		o3derrboundC = (26.0 + 288.0 * epsilon) * epsilon * epsilon;
		iccerrboundA = (10.0 + 96.0 * epsilon) * epsilon;
		iccerrboundB = (4.0 + 48.0 * epsilon) * epsilon;
		iccerrboundC = (44.0 + 576.0 * epsilon) * epsilon * epsilon;
		isperrboundA = (16.0 + 224.0 * epsilon) * epsilon;
		isperrboundB = (5.0 + 72.0 * epsilon) * epsilon;
		isperrboundC = (71.0 + 1408.0 * epsilon) * epsilon * epsilon;
	}

	private static int fast_expansion_sum_zeroelim(int elen, double[] e, int flen, double[] f, double[] h) {
		double Q;
		double Qnew;
		double hh;
		double bvirt;
		double avirt, bround, around;
		int eindex, findex, hindex;
		double enow, fnow;

		enow = e[0];
		fnow = f[0];
		eindex = findex = 0;
		if ((fnow > enow) == (fnow > -enow)) {
			Q = enow;
			enow = e[++eindex];
		} else {
			Q = fnow;
			fnow = f[++findex];
		}
		hindex = 0;
		if ((eindex < elen) && (findex < flen)) {
			if ((fnow > enow) == (fnow > -enow)) {
				Qnew = (double) (enow + Q);
				bvirt = Qnew - enow;
				hh = Q - bvirt;
				enow = e[++eindex];
			} else {
				Qnew = (double) (fnow + Q);
				bvirt = Qnew - fnow;
				hh = Q - bvirt;
				fnow = f[++findex];
			}
			Q = Qnew;
			if (hh != 0.0) {
				h[hindex++] = hh;
			}
			while ((eindex < elen) && (findex < flen)) {
				if ((fnow > enow) == (fnow > -enow)) {
					Qnew = (double) (Q + enow);
					bvirt = (double) (Qnew - Q);
					avirt = Qnew - bvirt;
					bround = enow - bvirt;
					around = Q - avirt;
					hh = around + bround;
					eindex++;
					if (eindex < elen) { // Check before reading
						enow = e[eindex];
					}
				} else {
					Qnew = (double) (Q + fnow);
					bvirt = (double) (Qnew - Q);
					avirt = Qnew - bvirt;
					bround = fnow - bvirt;
					around = Q - avirt;
					hh = around + bround;
					findex++;
					if (findex < flen) { // Check before reading
						fnow = f[findex];
					}
				}
				Q = Qnew;
				if (hh != 0.0) {
					h[hindex++] = hh;
				}
			}
		}
		while (eindex < elen) {
			Qnew = (double) (Q + enow);
			bvirt = (double) (Qnew - Q);
			avirt = Qnew - bvirt;
			bround = enow - bvirt;
			around = Q - avirt;
			hh = around + bround;
			Q = Qnew;
			if (hh != 0.0) {
				h[hindex++] = hh;
			}
			eindex++;
			if (eindex < elen) { // Check before reading
				enow = e[eindex];
			}
		}

		while (findex < flen) {
			Qnew = (double) (Q + fnow);
			bvirt = (double) (Qnew - Q);
			avirt = Qnew - bvirt;
			bround = fnow - bvirt;
			around = Q - avirt;
			hh = around + bround;
			Q = Qnew;
			if (hh != 0.0) {
				h[hindex++] = hh;
			}
			findex++;
			if (findex < flen) { // Check before reading
				fnow = f[findex];
			}
		}
		if ((Q != 0.0) || (hindex == 0)) {
			h[hindex++] = Q;
		}
		return hindex;
	}

	private static int scale_expansion_zeroelim(int elen, double[] e, double b, double[] h) {
		double Q, sum;
		double hh;
		double product1;
		double product0;
		int eindex, hindex;
		double enow;
		double bvirt;
		double avirt, bround, around;
		double c;
		double abig;
		double ahi, alo, bhi, blo;
		double err1, err2, err3;

		c = (double) (splitter * b);
		abig = (double) (c - b);
		bhi = c - abig;
		blo = b - bhi;
		Q = (double) (e[0] * b);
		c = (double) (splitter * e[0]);
		abig = (double) (c - e[0]);
		ahi = c - abig;
		alo = e[0] - ahi;
		err1 = Q - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		hh = (alo * blo) - err3;
		hindex = 0;
		if (hh != 0) {
			h[hindex++] = hh;
		}
		for (eindex = 1; eindex < elen; eindex++) {
			enow = e[eindex];
			product1 = (double) (enow * b);
			c = (double) (splitter * enow);
			abig = (double) (c - enow);
			ahi = c - abig;
			alo = enow - ahi;
			err1 = product1 - (ahi * bhi);
			err2 = err1 - (alo * bhi);
			err3 = err2 - (ahi * blo);
			product0 = (alo * blo) - err3;
			sum = (double) (Q + product0);
			bvirt = (double) (sum - Q);
			avirt = sum - bvirt;
			bround = product0 - bvirt;
			around = Q - avirt;
			hh = around + bround;
			if (hh != 0) {
				h[hindex++] = hh;
			}
			Q = (double) (product1 + sum);
			bvirt = Q - product1;
			hh = sum - bvirt;
			if (hh != 0) {
				h[hindex++] = hh;
			}
		}
		if ((Q != 0.0) || (hindex == 0)) {
			h[hindex++] = Q;
		}
		return hindex;
	}

	private static double estimate(int elen, double[] e) {
		double Q;
		int eindex;

		Q = e[0];
		for (eindex = 1; eindex < elen; eindex++) {
			Q += e[eindex];
		}
		return Q;
	}

	@SuppressWarnings("unused")
	private static double orient2dexact(double[] pa, double[] pb, double[] pc) {
		double axby1, axcy1, bxcy1, bxay1, cxay1, cxby1;
		double axby0, axcy0, bxcy0, bxay0, cxay0, cxby0;
		double[] aterms = new double[4], bterms = new double[4], cterms = new double[4];
		double aterms3, bterms3, cterms3;
		double[] v = new double[8], w = new double[12];
		int vlength, wlength;

		double bvirt;
		double avirt, bround, around;
		double c;
		double abig;
		double ahi, alo, bhi, blo;
		double err1, err2, err3;
		double _i, _j;
		double _0;

		axby1 = (double) (pa[0] * pb[1]);
		c = (double) (splitter * pa[0]);
		abig = (double) (c - pa[0]);
		ahi = c - abig;
		alo = pa[0] - ahi;
		c = (double) (splitter * pb[1]);
		abig = (double) (c - pb[1]);
		bhi = c - abig;
		blo = pb[1] - bhi;
		err1 = axby1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		axby0 = (alo * blo) - err3;
		axcy1 = (double) (pa[0] * pc[1]);
		c = (double) (splitter * pa[0]);
		abig = (double) (c - pa[0]);
		ahi = c - abig;
		alo = pa[0] - ahi;
		c = (double) (splitter * pc[1]);
		abig = (double) (c - pc[1]);
		bhi = c - abig;
		blo = pc[1] - bhi;
		err1 = axcy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		axcy0 = (alo * blo) - err3;
		_i = (double) (axby0 - axcy0);
		bvirt = (double) (axby0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - axcy0;
		around = axby0 - avirt;
		aterms[0] = around + bround;
		_j = (double) (axby1 + _i);
		bvirt = (double) (_j - axby1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = axby1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - axcy1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - axcy1;
		around = _0 - avirt;
		aterms[1] = around + bround;
		aterms3 = (double) (_j + _i);
		bvirt = (double) (aterms3 - _j);
		avirt = aterms3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		aterms[2] = around + bround;

		aterms[3] = aterms3;

		bxcy1 = (double) (pb[0] * pc[1]);
		c = (double) (splitter * pb[0]);
		abig = (double) (c - pb[0]);
		ahi = c - abig;
		alo = pb[0] - ahi;
		c = (double) (splitter * pc[1]);
		abig = (double) (c - pc[1]);
		bhi = c - abig;
		blo = pc[1] - bhi;
		err1 = bxcy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		bxcy0 = (alo * blo) - err3;
		bxay1 = (double) (pb[0] * pa[1]);
		c = (double) (splitter * pb[0]);
		abig = (double) (c - pb[0]);
		ahi = c - abig;
		alo = pb[0] - ahi;
		c = (double) (splitter * pa[1]);
		abig = (double) (c - pa[1]);
		bhi = c - abig;
		blo = pa[1] - bhi;
		err1 = bxay1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		bxay0 = (alo * blo) - err3;
		_i = (double) (bxcy0 - bxay0);
		bvirt = (double) (bxcy0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - bxay0;
		around = bxcy0 - avirt;
		bterms[0] = around + bround;
		_j = (double) (bxcy1 + _i);
		bvirt = (double) (_j - bxcy1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = bxcy1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - bxay1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - bxay1;
		around = _0 - avirt;
		bterms[1] = around + bround;
		bterms3 = (double) (_j + _i);
		bvirt = (double) (bterms3 - _j);
		avirt = bterms3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		bterms[2] = around + bround;

		bterms[3] = bterms3;

		cxay1 = (double) (pc[0] * pa[1]);
		c = (double) (splitter * pc[0]);
		abig = (double) (c - pc[0]);
		ahi = c - abig;
		alo = pc[0] - ahi;
		c = (double) (splitter * pa[1]);
		abig = (double) (c - pa[1]);
		bhi = c - abig;
		blo = pa[1] - bhi;
		err1 = cxay1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		cxay0 = (alo * blo) - err3;
		cxby1 = (double) (pc[0] * pb[1]);
		c = (double) (splitter * pc[0]);
		abig = (double) (c - pc[0]);
		ahi = c - abig;
		alo = pc[0] - ahi;
		c = (double) (splitter * pb[1]);
		abig = (double) (c - pb[1]);
		bhi = c - abig;
		blo = pb[1] - bhi;
		err1 = cxby1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		cxby0 = (alo * blo) - err3;
		_i = (double) (cxay0 - cxby0);
		bvirt = (double) (cxay0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - cxby0;
		around = cxay0 - avirt;
		cterms[0] = around + bround;
		_j = (double) (cxay1 + _i);
		bvirt = (double) (_j - cxay1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = cxay1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - cxby1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - cxby1;
		around = _0 - avirt;
		cterms[1] = around + bround;
		cterms3 = (double) (_j + _i);
		bvirt = (double) (cterms3 - _j);
		avirt = cterms3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		cterms[2] = around + bround;

		cterms[3] = cterms3;

		vlength = fast_expansion_sum_zeroelim(4, aterms, 4, bterms, v);
		wlength = fast_expansion_sum_zeroelim(vlength, v, 4, cterms, w);

		return w[wlength - 1];
	}

	@SuppressWarnings("unused")
	private static double orient2dslow(double[] pa, double[] pb, double[] pc) {
		double acx, acy, bcx, bcy;
		double acxtail, acytail;
		double bcxtail, bcytail;
		double negate, negatetail;
		double[] axby = new double[8], bxay = new double[8];
		double axby7, bxay7;
		double[] deter = new double[16];
		int deterlen;

		double bvirt;
		double avirt, bround, around;
		double c;
		double abig;
		double a0hi, a0lo, a1hi, a1lo, bhi, blo;
		double err1, err2, err3;
		double _i, _j, _k, _l, _m, _n;
		double _0, _1, _2;

		acx = (double) (pa[0] - pc[0]);
		bvirt = (double) (pa[0] - acx);
		avirt = acx + bvirt;
		bround = bvirt - pc[0];
		around = pa[0] - avirt;
		acxtail = around + bround;
		acy = (double) (pa[1] - pc[1]);
		bvirt = (double) (pa[1] - acy);
		avirt = acy + bvirt;
		bround = bvirt - pc[1];
		around = pa[1] - avirt;
		acytail = around + bround;
		bcx = (double) (pb[0] - pc[0]);
		bvirt = (double) (pb[0] - bcx);
		avirt = bcx + bvirt;
		bround = bvirt - pc[0];
		around = pb[0] - avirt;
		bcxtail = around + bround;
		bcy = (double) (pb[1] - pc[1]);
		bvirt = (double) (pb[1] - bcy);
		avirt = bcy + bvirt;
		bround = bvirt - pc[1];
		around = pb[1] - avirt;
		bcytail = around + bround;

		c = (double) (splitter * acxtail);
		abig = (double) (c - acxtail);
		a0hi = c - abig;
		a0lo = acxtail - a0hi;
		c = (double) (splitter * bcytail);
		abig = (double) (c - bcytail);
		bhi = c - abig;
		blo = bcytail - bhi;
		_i = (double) (acxtail * bcytail);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		axby[0] = (a0lo * blo) - err3;
		c = (double) (splitter * acx);
		abig = (double) (c - acx);
		a1hi = c - abig;
		a1lo = acx - a1hi;
		_j = (double) (acx * bcytail);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_k = (double) (_i + _0);
		bvirt = (double) (_k - _i);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_1 = around + bround;
		_l = (double) (_j + _k);
		bvirt = _l - _j;
		_2 = _k - bvirt;
		c = (double) (splitter * bcy);
		abig = (double) (c - bcy);
		bhi = c - abig;
		blo = bcy - bhi;
		_i = (double) (acxtail * bcy);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		_0 = (a0lo * blo) - err3;
		_k = (double) (_1 + _0);
		bvirt = (double) (_k - _1);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		axby[1] = around + bround;
		_j = (double) (_2 + _k);
		bvirt = (double) (_j - _2);
		avirt = _j - bvirt;
		bround = _k - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _j);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _j - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_j = (double) (acx * bcy);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_n = (double) (_i + _0);
		bvirt = (double) (_n - _i);
		avirt = _n - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_0 = around + bround;
		_i = (double) (_1 + _0);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		axby[2] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_l = (double) (_m + _k);
		bvirt = (double) (_l - _m);
		avirt = _l - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		_2 = around + bround;
		_k = (double) (_j + _n);
		bvirt = (double) (_k - _j);
		avirt = _k - bvirt;
		bround = _n - bvirt;
		around = _j - avirt;
		_0 = around + bround;
		_j = (double) (_1 + _0);
		bvirt = (double) (_j - _1);
		avirt = _j - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		axby[3] = around + bround;
		_i = (double) (_2 + _j);
		bvirt = (double) (_i - _2);
		avirt = _i - bvirt;
		bround = _j - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _i);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _i - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_i = (double) (_1 + _k);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _k - bvirt;
		around = _1 - avirt;
		axby[4] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		axby[5] = around + bround;
		axby7 = (double) (_m + _k);
		bvirt = (double) (axby7 - _m);
		avirt = axby7 - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		axby[6] = around + bround;

		axby[7] = axby7;
		negate = -acy;
		negatetail = -acytail;
		c = (double) (splitter * bcxtail);
		abig = (double) (c - bcxtail);
		a0hi = c - abig;
		a0lo = bcxtail - a0hi;
		c = (double) (splitter * negatetail);
		abig = (double) (c - negatetail);
		bhi = c - abig;
		blo = negatetail - bhi;
		_i = (double) (bcxtail * negatetail);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		bxay[0] = (a0lo * blo) - err3;
		c = (double) (splitter * bcx);
		abig = (double) (c - bcx);
		a1hi = c - abig;
		a1lo = bcx - a1hi;
		_j = (double) (bcx * negatetail);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_k = (double) (_i + _0);
		bvirt = (double) (_k - _i);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_1 = around + bround;
		_l = (double) (_j + _k);
		bvirt = _l - _j;
		_2 = _k - bvirt;
		c = (double) (splitter * negate);
		abig = (double) (c - negate);
		bhi = c - abig;
		blo = negate - bhi;
		_i = (double) (bcxtail * negate);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		_0 = (a0lo * blo) - err3;
		_k = (double) (_1 + _0);
		bvirt = (double) (_k - _1);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		bxay[1] = around + bround;
		_j = (double) (_2 + _k);
		bvirt = (double) (_j - _2);
		avirt = _j - bvirt;
		bround = _k - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _j);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _j - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_j = (double) (bcx * negate);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_n = (double) (_i + _0);
		bvirt = (double) (_n - _i);
		avirt = _n - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_0 = around + bround;
		_i = (double) (_1 + _0);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		bxay[2] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_l = (double) (_m + _k);
		bvirt = (double) (_l - _m);
		avirt = _l - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		_2 = around + bround;
		_k = (double) (_j + _n);
		bvirt = (double) (_k - _j);
		avirt = _k - bvirt;
		bround = _n - bvirt;
		around = _j - avirt;
		_0 = around + bround;
		_j = (double) (_1 + _0);
		bvirt = (double) (_j - _1);
		avirt = _j - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		bxay[3] = around + bround;
		_i = (double) (_2 + _j);
		bvirt = (double) (_i - _2);
		avirt = _i - bvirt;
		bround = _j - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _i);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _i - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_i = (double) (_1 + _k);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _k - bvirt;
		around = _1 - avirt;
		bxay[4] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		bxay[5] = around + bround;
		bxay7 = (double) (_m + _k);
		bvirt = (double) (bxay7 - _m);
		avirt = bxay7 - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		bxay[6] = around + bround;

		bxay[7] = bxay7;

		deterlen = fast_expansion_sum_zeroelim(8, axby, 8, bxay, deter);

		return deter[deterlen - 1];
	}

	private static double orient2dadapt(double[] pa, double[] pb, double[] pc, double detsum) {
		double acx, acy, bcx, bcy;
		double acxtail, acytail, bcxtail, bcytail;
		double detleft, detright;
		double detlefttail, detrighttail;
		double det, errbound;
		double[] B = new double[4], C1 = new double[8], C2 = new double[12], D = new double[16];
		double B3;
		int C1length, C2length, Dlength;
		double[] u = new double[4];
		double u3;
		double s1, t1;
		double s0, t0;

		double bvirt;
		double avirt, bround, around;
		double c;
		double abig;
		double ahi, alo, bhi, blo;
		double err1, err2, err3;
		double _i, _j;
		double _0;

		acx = (double) (pa[0] - pc[0]);
		bcx = (double) (pb[0] - pc[0]);
		acy = (double) (pa[1] - pc[1]);
		bcy = (double) (pb[1] - pc[1]);

		detleft = (double) (acx * bcy);
		c = (double) (splitter * acx);
		abig = (double) (c - acx);
		ahi = c - abig;
		alo = acx - ahi;
		c = (double) (splitter * bcy);
		abig = (double) (c - bcy);
		bhi = c - abig;
		blo = bcy - bhi;
		err1 = detleft - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		detlefttail = (alo * blo) - err3;
		detright = (double) (acy * bcx);
		c = (double) (splitter * acy);
		abig = (double) (c - acy);
		ahi = c - abig;
		alo = acy - ahi;
		c = (double) (splitter * bcx);
		abig = (double) (c - bcx);
		bhi = c - abig;
		blo = bcx - bhi;
		err1 = detright - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		detrighttail = (alo * blo) - err3;

		_i = (double) (detlefttail - detrighttail);
		bvirt = (double) (detlefttail - _i);
		avirt = _i + bvirt;
		bround = bvirt - detrighttail;
		around = detlefttail - avirt;
		B[0] = around + bround;
		_j = (double) (detleft + _i);
		bvirt = (double) (_j - detleft);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = detleft - avirt;
		_0 = around + bround;
		_i = (double) (_0 - detright);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - detright;
		around = _0 - avirt;
		B[1] = around + bround;
		B3 = (double) (_j + _i);
		bvirt = (double) (B3 - _j);
		avirt = B3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		B[2] = around + bround;

		B[3] = B3;

		det = estimate(4, B);
		errbound = ccwerrboundB * detsum;
		if ((det >= errbound) || (-det >= errbound)) {
			return det;
		}

		bvirt = (double) (pa[0] - acx);
		avirt = acx + bvirt;
		bround = bvirt - pc[0];
		around = pa[0] - avirt;
		acxtail = around + bround;
		bvirt = (double) (pb[0] - bcx);
		avirt = bcx + bvirt;
		bround = bvirt - pc[0];
		around = pb[0] - avirt;
		bcxtail = around + bround;
		bvirt = (double) (pa[1] - acy);
		avirt = acy + bvirt;
		bround = bvirt - pc[1];
		around = pa[1] - avirt;
		acytail = around + bround;
		bvirt = (double) (pb[1] - bcy);
		avirt = bcy + bvirt;
		bround = bvirt - pc[1];
		around = pb[1] - avirt;
		bcytail = around + bround;

		if ((acxtail == 0.0) && (acytail == 0.0) && (bcxtail == 0.0) && (bcytail == 0.0)) {
			return det;
		}

		errbound = ccwerrboundC * detsum + resulterrbound * ((det) >= 0.0 ? (det) : -(det));
		det += (acx * bcytail + bcy * acxtail) - (acy * bcxtail + bcx * acytail);
		if ((det >= errbound) || (-det >= errbound)) {
			return det;
		}

		s1 = (double) (acxtail * bcy);
		c = (double) (splitter * acxtail);
		abig = (double) (c - acxtail);
		ahi = c - abig;
		alo = acxtail - ahi;
		c = (double) (splitter * bcy);
		abig = (double) (c - bcy);
		bhi = c - abig;
		blo = bcy - bhi;
		err1 = s1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		s0 = (alo * blo) - err3;
		t1 = (double) (acytail * bcx);
		c = (double) (splitter * acytail);
		abig = (double) (c - acytail);
		ahi = c - abig;
		alo = acytail - ahi;
		c = (double) (splitter * bcx);
		abig = (double) (c - bcx);
		bhi = c - abig;
		blo = bcx - bhi;
		err1 = t1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		t0 = (alo * blo) - err3;
		_i = (double) (s0 - t0);
		bvirt = (double) (s0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - t0;
		around = s0 - avirt;
		u[0] = around + bround;
		_j = (double) (s1 + _i);
		bvirt = (double) (_j - s1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = s1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - t1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - t1;
		around = _0 - avirt;
		u[1] = around + bround;
		u3 = (double) (_j + _i);
		bvirt = (double) (u3 - _j);
		avirt = u3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		u[2] = around + bround;
		u[3] = u3;
		C1length = fast_expansion_sum_zeroelim(4, B, 4, u, C1);

		s1 = (double) (acx * bcytail);
		c = (double) (splitter * acx);
		abig = (double) (c - acx);
		ahi = c - abig;
		alo = acx - ahi;
		c = (double) (splitter * bcytail);
		abig = (double) (c - bcytail);
		bhi = c - abig;
		blo = bcytail - bhi;
		err1 = s1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		s0 = (alo * blo) - err3;
		t1 = (double) (acy * bcxtail);
		c = (double) (splitter * acy);
		abig = (double) (c - acy);
		ahi = c - abig;
		alo = acy - ahi;
		c = (double) (splitter * bcxtail);
		abig = (double) (c - bcxtail);
		bhi = c - abig;
		blo = bcxtail - bhi;
		err1 = t1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		t0 = (alo * blo) - err3;
		_i = (double) (s0 - t0);
		bvirt = (double) (s0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - t0;
		around = s0 - avirt;
		u[0] = around + bround;
		_j = (double) (s1 + _i);
		bvirt = (double) (_j - s1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = s1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - t1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - t1;
		around = _0 - avirt;
		u[1] = around + bround;
		u3 = (double) (_j + _i);
		bvirt = (double) (u3 - _j);
		avirt = u3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		u[2] = around + bround;
		u[3] = u3;
		C2length = fast_expansion_sum_zeroelim(C1length, C1, 4, u, C2);

		s1 = (double) (acxtail * bcytail);
		c = (double) (splitter * acxtail);
		abig = (double) (c - acxtail);
		ahi = c - abig;
		alo = acxtail - ahi;
		c = (double) (splitter * bcytail);
		abig = (double) (c - bcytail);
		bhi = c - abig;
		blo = bcytail - bhi;
		err1 = s1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		s0 = (alo * blo) - err3;
		t1 = (double) (acytail * bcxtail);
		c = (double) (splitter * acytail);
		abig = (double) (c - acytail);
		ahi = c - abig;
		alo = acytail - ahi;
		c = (double) (splitter * bcxtail);
		abig = (double) (c - bcxtail);
		bhi = c - abig;
		blo = bcxtail - bhi;
		err1 = t1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		t0 = (alo * blo) - err3;
		_i = (double) (s0 - t0);
		bvirt = (double) (s0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - t0;
		around = s0 - avirt;
		u[0] = around + bround;
		_j = (double) (s1 + _i);
		bvirt = (double) (_j - s1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = s1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - t1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - t1;
		around = _0 - avirt;
		u[1] = around + bround;
		u3 = (double) (_j + _i);
		bvirt = (double) (u3 - _j);
		avirt = u3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		u[2] = around + bround;
		u[3] = u3;
		Dlength = fast_expansion_sum_zeroelim(C2length, C2, 4, u, D);

		return (D[Dlength - 1]);
	}

	@SuppressWarnings("unused")
	private static double orient2d(double[] pa, double[] pb, double[] pc) {
		double detleft, detright, det;
		double detsum, errbound;

		detleft = (pa[0] - pc[0]) * (pb[1] - pc[1]);
		detright = (pa[1] - pc[1]) * (pb[0] - pc[0]);
		det = detleft - detright;

		if (detleft > 0.0) {
			if (detright <= 0.0) {
				return det;
			} else {
				detsum = detleft + detright;
			}
		} else if (detleft < 0.0) {
			if (detright >= 0.0) {
				return det;
			} else {
				detsum = -detleft - detright;
			}
		} else {
			return det;
		}

		errbound = ccwerrboundA * detsum;
		if ((det >= errbound) || (-det >= errbound)) {
			return det;
		}

		return orient2dadapt(pa, pb, pc, detsum);
	}

	double orient3dexact(double[] pa, double[] pb, double[] pc, double[] pd) {
		double axby1, bxcy1, cxdy1, dxay1, axcy1, bxdy1;
		double bxay1, cxby1, dxcy1, axdy1, cxay1, dxby1;
		double axby0, bxcy0, cxdy0, dxay0, axcy0, bxdy0;
		double bxay0, cxby0, dxcy0, axdy0, cxay0, dxby0;
		double[] ab = new double[4], bc = new double[4], cd = new double[4], da = new double[4], ac = new double[4], bd = new double[4];
		double[] temp8 = new double[8];
		int templen;
		double[] abc = new double[12], bcd = new double[12], cda = new double[12], dab = new double[12];
		int abclen, bcdlen, cdalen, dablen;
		double[] adet = new double[24], bdet = new double[24], cdet = new double[24], ddet = new double[24];
		int alen, blen, clen, dlen;
		double[] abdet = new double[48], cddet = new double[48];
		int ablen, cdlen;
		double[] deter = new double[96];

		int deterlen;
		int i;

		double bvirt;
		double avirt, bround, around;
		double c;
		double abig;
		double ahi, alo, bhi, blo;
		double err1, err2, err3;
		double _i, _j;
		double _0;

		axby1 = (double) (pa[0] * pb[1]);
		c = (double) (splitter * pa[0]);
		abig = (double) (c - pa[0]);
		ahi = c - abig;
		alo = pa[0] - ahi;
		c = (double) (splitter * pb[1]);
		abig = (double) (c - pb[1]);
		bhi = c - abig;
		blo = pb[1] - bhi;
		err1 = axby1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		axby0 = (alo * blo) - err3;
		bxay1 = (double) (pb[0] * pa[1]);
		c = (double) (splitter * pb[0]);
		abig = (double) (c - pb[0]);
		ahi = c - abig;
		alo = pb[0] - ahi;
		c = (double) (splitter * pa[1]);
		abig = (double) (c - pa[1]);
		bhi = c - abig;
		blo = pa[1] - bhi;
		err1 = bxay1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		bxay0 = (alo * blo) - err3;
		_i = (double) (axby0 - bxay0);
		bvirt = (double) (axby0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - bxay0;
		around = axby0 - avirt;
		ab[0] = around + bround;
		_j = (double) (axby1 + _i);
		bvirt = (double) (_j - axby1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = axby1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - bxay1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - bxay1;
		around = _0 - avirt;
		ab[1] = around + bround;
		ab[3] = (double) (_j + _i);
		bvirt = (double) (ab[3] - _j);
		avirt = ab[3] - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		ab[2] = around + bround;

		bxcy1 = (double) (pb[0] * pc[1]);
		c = (double) (splitter * pb[0]);
		abig = (double) (c - pb[0]);
		ahi = c - abig;
		alo = pb[0] - ahi;
		c = (double) (splitter * pc[1]);
		abig = (double) (c - pc[1]);
		bhi = c - abig;
		blo = pc[1] - bhi;
		err1 = bxcy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		bxcy0 = (alo * blo) - err3;
		cxby1 = (double) (pc[0] * pb[1]);
		c = (double) (splitter * pc[0]);
		abig = (double) (c - pc[0]);
		ahi = c - abig;
		alo = pc[0] - ahi;
		c = (double) (splitter * pb[1]);
		abig = (double) (c - pb[1]);
		bhi = c - abig;
		blo = pb[1] - bhi;
		err1 = cxby1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		cxby0 = (alo * blo) - err3;
		_i = (double) (bxcy0 - cxby0);
		bvirt = (double) (bxcy0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - cxby0;
		around = bxcy0 - avirt;
		bc[0] = around + bround;
		_j = (double) (bxcy1 + _i);
		bvirt = (double) (_j - bxcy1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = bxcy1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - cxby1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - cxby1;
		around = _0 - avirt;
		bc[1] = around + bround;
		bc[3] = (double) (_j + _i);
		bvirt = (double) (bc[3] - _j);
		avirt = bc[3] - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		bc[2] = around + bround;

		cxdy1 = (double) (pc[0] * pd[1]);
		c = (double) (splitter * pc[0]);
		abig = (double) (c - pc[0]);
		ahi = c - abig;
		alo = pc[0] - ahi;
		c = (double) (splitter * pd[1]);
		abig = (double) (c - pd[1]);
		bhi = c - abig;
		blo = pd[1] - bhi;
		err1 = cxdy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		cxdy0 = (alo * blo) - err3;
		dxcy1 = (double) (pd[0] * pc[1]);
		c = (double) (splitter * pd[0]);
		abig = (double) (c - pd[0]);
		ahi = c - abig;
		alo = pd[0] - ahi;
		c = (double) (splitter * pc[1]);
		abig = (double) (c - pc[1]);
		bhi = c - abig;
		blo = pc[1] - bhi;
		err1 = dxcy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		dxcy0 = (alo * blo) - err3;
		_i = (double) (cxdy0 - dxcy0);
		bvirt = (double) (cxdy0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - dxcy0;
		around = cxdy0 - avirt;
		cd[0] = around + bround;
		_j = (double) (cxdy1 + _i);
		bvirt = (double) (_j - cxdy1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = cxdy1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - dxcy1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - dxcy1;
		around = _0 - avirt;
		cd[1] = around + bround;
		cd[3] = (double) (_j + _i);
		bvirt = (double) (cd[3] - _j);
		avirt = cd[3] - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		cd[2] = around + bround;

		dxay1 = (double) (pd[0] * pa[1]);
		c = (double) (splitter * pd[0]);
		abig = (double) (c - pd[0]);
		ahi = c - abig;
		alo = pd[0] - ahi;
		c = (double) (splitter * pa[1]);
		abig = (double) (c - pa[1]);
		bhi = c - abig;
		blo = pa[1] - bhi;
		err1 = dxay1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		dxay0 = (alo * blo) - err3;
		axdy1 = (double) (pa[0] * pd[1]);
		c = (double) (splitter * pa[0]);
		abig = (double) (c - pa[0]);
		ahi = c - abig;
		alo = pa[0] - ahi;
		c = (double) (splitter * pd[1]);
		abig = (double) (c - pd[1]);
		bhi = c - abig;
		blo = pd[1] - bhi;
		err1 = axdy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		axdy0 = (alo * blo) - err3;
		_i = (double) (dxay0 - axdy0);
		bvirt = (double) (dxay0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - axdy0;
		around = dxay0 - avirt;
		da[0] = around + bround;
		_j = (double) (dxay1 + _i);
		bvirt = (double) (_j - dxay1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = dxay1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - axdy1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - axdy1;
		around = _0 - avirt;
		da[1] = around + bround;
		da[3] = (double) (_j + _i);
		bvirt = (double) (da[3] - _j);
		avirt = da[3] - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		da[2] = around + bround;

		axcy1 = (double) (pa[0] * pc[1]);
		c = (double) (splitter * pa[0]);
		abig = (double) (c - pa[0]);
		ahi = c - abig;
		alo = pa[0] - ahi;
		c = (double) (splitter * pc[1]);
		abig = (double) (c - pc[1]);
		bhi = c - abig;
		blo = pc[1] - bhi;
		err1 = axcy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		axcy0 = (alo * blo) - err3;
		cxay1 = (double) (pc[0] * pa[1]);
		c = (double) (splitter * pc[0]);
		abig = (double) (c - pc[0]);
		ahi = c - abig;
		alo = pc[0] - ahi;
		c = (double) (splitter * pa[1]);
		abig = (double) (c - pa[1]);
		bhi = c - abig;
		blo = pa[1] - bhi;
		err1 = cxay1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		cxay0 = (alo * blo) - err3;
		_i = (double) (axcy0 - cxay0);
		bvirt = (double) (axcy0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - cxay0;
		around = axcy0 - avirt;
		ac[0] = around + bround;
		_j = (double) (axcy1 + _i);
		bvirt = (double) (_j - axcy1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = axcy1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - cxay1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - cxay1;
		around = _0 - avirt;
		ac[1] = around + bround;
		ac[3] = (double) (_j + _i);
		bvirt = (double) (ac[3] - _j);
		avirt = ac[3] - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		ac[2] = around + bround;

		bxdy1 = (double) (pb[0] * pd[1]);
		c = (double) (splitter * pb[0]);
		abig = (double) (c - pb[0]);
		ahi = c - abig;
		alo = pb[0] - ahi;
		c = (double) (splitter * pd[1]);
		abig = (double) (c - pd[1]);
		bhi = c - abig;
		blo = pd[1] - bhi;
		err1 = bxdy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		bxdy0 = (alo * blo) - err3;
		dxby1 = (double) (pd[0] * pb[1]);
		c = (double) (splitter * pd[0]);
		abig = (double) (c - pd[0]);
		ahi = c - abig;
		alo = pd[0] - ahi;
		c = (double) (splitter * pb[1]);
		abig = (double) (c - pb[1]);
		bhi = c - abig;
		blo = pb[1] - bhi;
		err1 = dxby1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		dxby0 = (alo * blo) - err3;
		_i = (double) (bxdy0 - dxby0);
		bvirt = (double) (bxdy0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - dxby0;
		around = bxdy0 - avirt;
		bd[0] = around + bround;
		_j = (double) (bxdy1 + _i);
		bvirt = (double) (_j - bxdy1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = bxdy1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - dxby1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - dxby1;
		around = _0 - avirt;
		bd[1] = around + bround;
		bd[3] = (double) (_j + _i);
		bvirt = (double) (bd[3] - _j);
		avirt = bd[3] - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		bd[2] = around + bround;

		templen = fast_expansion_sum_zeroelim(4, cd, 4, da, temp8);
		cdalen = fast_expansion_sum_zeroelim(templen, temp8, 4, ac, cda);
		templen = fast_expansion_sum_zeroelim(4, da, 4, ab, temp8);
		dablen = fast_expansion_sum_zeroelim(templen, temp8, 4, bd, dab);
		for (i = 0; i < 4; i++) {
			bd[i] = -bd[i];
			ac[i] = -ac[i];
		}
		templen = fast_expansion_sum_zeroelim(4, ab, 4, bc, temp8);
		abclen = fast_expansion_sum_zeroelim(templen, temp8, 4, ac, abc);
		templen = fast_expansion_sum_zeroelim(4, bc, 4, cd, temp8);
		bcdlen = fast_expansion_sum_zeroelim(templen, temp8, 4, bd, bcd);

		alen = scale_expansion_zeroelim(bcdlen, bcd, pa[2], adet);
		blen = scale_expansion_zeroelim(cdalen, cda, -pb[2], bdet);
		clen = scale_expansion_zeroelim(dablen, dab, pc[2], cdet);
		dlen = scale_expansion_zeroelim(abclen, abc, -pd[2], ddet);

		ablen = fast_expansion_sum_zeroelim(alen, adet, blen, bdet, abdet);
		cdlen = fast_expansion_sum_zeroelim(clen, cdet, dlen, ddet, cddet);
		deterlen = fast_expansion_sum_zeroelim(ablen, abdet, cdlen, cddet, deter);

		return deter[deterlen - 1];
	}

	double orient3dslow(double[] pa, double[] pb, double[] pc, double[] pd) {
		double adx, ady, adz, bdx, bdy, bdz, cdx, cdy, cdz;
		double adxtail, adytail, adztail;
		double bdxtail, bdytail, bdztail;
		double cdxtail, cdytail, cdztail;
		double negate, negatetail;
		double axby7, bxcy7, axcy7, bxay7, cxby7, cxay7;
		double[] axby = new double[8], bxcy = new double[8], axcy = new double[8], bxay = new double[8], cxby = new double[8], cxay = new double[8];
		double[] temp16 = new double[16], temp32 = new double[32], temp32t = new double[32];
		int temp16len, temp32len, temp32tlen;
		double[] adet = new double[64], bdet = new double[64], cdet = new double[64];
		int alen, blen, clen;
		double[] abdet = new double[128];
		int ablen;
		double[] deter = new double[192];
		int deterlen;

		double bvirt;
		double avirt, bround, around;
		double c;
		double abig;
		double a0hi, a0lo, a1hi, a1lo, bhi, blo;
		double err1, err2, err3;
		double _i, _j, _k, _l, _m, _n;
		double _0, _1, _2;

		adx = (double) (pa[0] - pd[0]);
		bvirt = (double) (pa[0] - adx);
		avirt = adx + bvirt;
		bround = bvirt - pd[0];
		around = pa[0] - avirt;
		adxtail = around + bround;
		ady = (double) (pa[1] - pd[1]);
		bvirt = (double) (pa[1] - ady);
		avirt = ady + bvirt;
		bround = bvirt - pd[1];
		around = pa[1] - avirt;
		adytail = around + bround;
		adz = (double) (pa[2] - pd[2]);
		bvirt = (double) (pa[2] - adz);
		avirt = adz + bvirt;
		bround = bvirt - pd[2];
		around = pa[2] - avirt;
		adztail = around + bround;
		bdx = (double) (pb[0] - pd[0]);
		bvirt = (double) (pb[0] - bdx);
		avirt = bdx + bvirt;
		bround = bvirt - pd[0];
		around = pb[0] - avirt;
		bdxtail = around + bround;
		bdy = (double) (pb[1] - pd[1]);
		bvirt = (double) (pb[1] - bdy);
		avirt = bdy + bvirt;
		bround = bvirt - pd[1];
		around = pb[1] - avirt;
		bdytail = around + bround;
		bdz = (double) (pb[2] - pd[2]);
		bvirt = (double) (pb[2] - bdz);
		avirt = bdz + bvirt;
		bround = bvirt - pd[2];
		around = pb[2] - avirt;
		bdztail = around + bround;
		cdx = (double) (pc[0] - pd[0]);
		bvirt = (double) (pc[0] - cdx);
		avirt = cdx + bvirt;
		bround = bvirt - pd[0];
		around = pc[0] - avirt;
		cdxtail = around + bround;
		cdy = (double) (pc[1] - pd[1]);
		bvirt = (double) (pc[1] - cdy);
		avirt = cdy + bvirt;
		bround = bvirt - pd[1];
		around = pc[1] - avirt;
		cdytail = around + bround;
		cdz = (double) (pc[2] - pd[2]);
		bvirt = (double) (pc[2] - cdz);
		avirt = cdz + bvirt;
		bround = bvirt - pd[2];
		around = pc[2] - avirt;
		cdztail = around + bround;

		c = (double) (splitter * adxtail);
		abig = (double) (c - adxtail);
		a0hi = c - abig;
		a0lo = adxtail - a0hi;
		c = (double) (splitter * bdytail);
		abig = (double) (c - bdytail);
		bhi = c - abig;
		blo = bdytail - bhi;
		_i = (double) (adxtail * bdytail);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		axby[0] = (a0lo * blo) - err3;
		c = (double) (splitter * adx);
		abig = (double) (c - adx);
		a1hi = c - abig;
		a1lo = adx - a1hi;
		_j = (double) (adx * bdytail);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_k = (double) (_i + _0);
		bvirt = (double) (_k - _i);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_1 = around + bround;
		_l = (double) (_j + _k);
		bvirt = _l - _j;
		_2 = _k - bvirt;
		c = (double) (splitter * bdy);
		abig = (double) (c - bdy);
		bhi = c - abig;
		blo = bdy - bhi;
		_i = (double) (adxtail * bdy);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		_0 = (a0lo * blo) - err3;
		_k = (double) (_1 + _0);
		bvirt = (double) (_k - _1);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		axby[1] = around + bround;
		_j = (double) (_2 + _k);
		bvirt = (double) (_j - _2);
		avirt = _j - bvirt;
		bround = _k - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _j);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _j - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_j = (double) (adx * bdy);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_n = (double) (_i + _0);
		bvirt = (double) (_n - _i);
		avirt = _n - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_0 = around + bround;
		_i = (double) (_1 + _0);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		axby[2] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_l = (double) (_m + _k);
		bvirt = (double) (_l - _m);
		avirt = _l - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		_2 = around + bround;
		_k = (double) (_j + _n);
		bvirt = (double) (_k - _j);
		avirt = _k - bvirt;
		bround = _n - bvirt;
		around = _j - avirt;
		_0 = around + bround;
		_j = (double) (_1 + _0);
		bvirt = (double) (_j - _1);
		avirt = _j - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		axby[3] = around + bround;
		_i = (double) (_2 + _j);
		bvirt = (double) (_i - _2);
		avirt = _i - bvirt;
		bround = _j - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _i);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _i - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_i = (double) (_1 + _k);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _k - bvirt;
		around = _1 - avirt;
		axby[4] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		axby[5] = around + bround;
		axby7 = (double) (_m + _k);
		bvirt = (double) (axby7 - _m);
		avirt = axby7 - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		axby[6] = around + bround;

		axby[7] = axby7;
		negate = -ady;
		negatetail = -adytail;
		c = (double) (splitter * bdxtail);
		abig = (double) (c - bdxtail);
		a0hi = c - abig;
		a0lo = bdxtail - a0hi;
		c = (double) (splitter * negatetail);
		abig = (double) (c - negatetail);
		bhi = c - abig;
		blo = negatetail - bhi;
		_i = (double) (bdxtail * negatetail);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		bxay[0] = (a0lo * blo) - err3;
		c = (double) (splitter * bdx);
		abig = (double) (c - bdx);
		a1hi = c - abig;
		a1lo = bdx - a1hi;
		_j = (double) (bdx * negatetail);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_k = (double) (_i + _0);
		bvirt = (double) (_k - _i);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_1 = around + bround;
		_l = (double) (_j + _k);
		bvirt = _l - _j;
		_2 = _k - bvirt;
		c = (double) (splitter * negate);
		abig = (double) (c - negate);
		bhi = c - abig;
		blo = negate - bhi;
		_i = (double) (bdxtail * negate);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		_0 = (a0lo * blo) - err3;
		_k = (double) (_1 + _0);
		bvirt = (double) (_k - _1);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		bxay[1] = around + bround;
		_j = (double) (_2 + _k);
		bvirt = (double) (_j - _2);
		avirt = _j - bvirt;
		bround = _k - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _j);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _j - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_j = (double) (bdx * negate);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_n = (double) (_i + _0);
		bvirt = (double) (_n - _i);
		avirt = _n - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_0 = around + bround;
		_i = (double) (_1 + _0);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		bxay[2] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_l = (double) (_m + _k);
		bvirt = (double) (_l - _m);
		avirt = _l - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		_2 = around + bround;
		_k = (double) (_j + _n);
		bvirt = (double) (_k - _j);
		avirt = _k - bvirt;
		bround = _n - bvirt;
		around = _j - avirt;
		_0 = around + bround;
		_j = (double) (_1 + _0);
		bvirt = (double) (_j - _1);
		avirt = _j - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		bxay[3] = around + bround;
		_i = (double) (_2 + _j);
		bvirt = (double) (_i - _2);
		avirt = _i - bvirt;
		bround = _j - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _i);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _i - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_i = (double) (_1 + _k);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _k - bvirt;
		around = _1 - avirt;
		bxay[4] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		bxay[5] = around + bround;
		bxay7 = (double) (_m + _k);
		bvirt = (double) (bxay7 - _m);
		avirt = bxay7 - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		bxay[6] = around + bround;

		bxay[7] = bxay7;
		c = (double) (splitter * bdxtail);
		abig = (double) (c - bdxtail);
		a0hi = c - abig;
		a0lo = bdxtail - a0hi;
		c = (double) (splitter * cdytail);
		abig = (double) (c - cdytail);
		bhi = c - abig;
		blo = cdytail - bhi;
		_i = (double) (bdxtail * cdytail);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		bxcy[0] = (a0lo * blo) - err3;
		c = (double) (splitter * bdx);
		abig = (double) (c - bdx);
		a1hi = c - abig;
		a1lo = bdx - a1hi;
		_j = (double) (bdx * cdytail);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_k = (double) (_i + _0);
		bvirt = (double) (_k - _i);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_1 = around + bround;
		_l = (double) (_j + _k);
		bvirt = _l - _j;
		_2 = _k - bvirt;
		c = (double) (splitter * cdy);
		abig = (double) (c - cdy);
		bhi = c - abig;
		blo = cdy - bhi;
		_i = (double) (bdxtail * cdy);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		_0 = (a0lo * blo) - err3;
		_k = (double) (_1 + _0);
		bvirt = (double) (_k - _1);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		bxcy[1] = around + bround;
		_j = (double) (_2 + _k);
		bvirt = (double) (_j - _2);
		avirt = _j - bvirt;
		bround = _k - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _j);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _j - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_j = (double) (bdx * cdy);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_n = (double) (_i + _0);
		bvirt = (double) (_n - _i);
		avirt = _n - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_0 = around + bround;
		_i = (double) (_1 + _0);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		bxcy[2] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_l = (double) (_m + _k);
		bvirt = (double) (_l - _m);
		avirt = _l - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		_2 = around + bround;
		_k = (double) (_j + _n);
		bvirt = (double) (_k - _j);
		avirt = _k - bvirt;
		bround = _n - bvirt;
		around = _j - avirt;
		_0 = around + bround;
		_j = (double) (_1 + _0);
		bvirt = (double) (_j - _1);
		avirt = _j - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		bxcy[3] = around + bround;
		_i = (double) (_2 + _j);
		bvirt = (double) (_i - _2);
		avirt = _i - bvirt;
		bround = _j - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _i);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _i - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_i = (double) (_1 + _k);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _k - bvirt;
		around = _1 - avirt;
		bxcy[4] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		bxcy[5] = around + bround;
		bxcy7 = (double) (_m + _k);
		bvirt = (double) (bxcy7 - _m);
		avirt = bxcy7 - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		bxcy[6] = around + bround;

		bxcy[7] = bxcy7;
		negate = -bdy;
		negatetail = -bdytail;
		c = (double) (splitter * cdxtail);
		abig = (double) (c - cdxtail);
		a0hi = c - abig;
		a0lo = cdxtail - a0hi;
		c = (double) (splitter * negatetail);
		abig = (double) (c - negatetail);
		bhi = c - abig;
		blo = negatetail - bhi;
		_i = (double) (cdxtail * negatetail);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		cxby[0] = (a0lo * blo) - err3;
		c = (double) (splitter * cdx);
		abig = (double) (c - cdx);
		a1hi = c - abig;
		a1lo = cdx - a1hi;
		_j = (double) (cdx * negatetail);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_k = (double) (_i + _0);
		bvirt = (double) (_k - _i);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_1 = around + bround;
		_l = (double) (_j + _k);
		bvirt = _l - _j;
		_2 = _k - bvirt;
		c = (double) (splitter * negate);
		abig = (double) (c - negate);
		bhi = c - abig;
		blo = negate - bhi;
		_i = (double) (cdxtail * negate);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		_0 = (a0lo * blo) - err3;
		_k = (double) (_1 + _0);
		bvirt = (double) (_k - _1);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		cxby[1] = around + bround;
		_j = (double) (_2 + _k);
		bvirt = (double) (_j - _2);
		avirt = _j - bvirt;
		bround = _k - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _j);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _j - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_j = (double) (cdx * negate);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_n = (double) (_i + _0);
		bvirt = (double) (_n - _i);
		avirt = _n - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_0 = around + bround;
		_i = (double) (_1 + _0);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		cxby[2] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_l = (double) (_m + _k);
		bvirt = (double) (_l - _m);
		avirt = _l - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		_2 = around + bround;
		_k = (double) (_j + _n);
		bvirt = (double) (_k - _j);
		avirt = _k - bvirt;
		bround = _n - bvirt;
		around = _j - avirt;
		_0 = around + bround;
		_j = (double) (_1 + _0);
		bvirt = (double) (_j - _1);
		avirt = _j - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		cxby[3] = around + bround;
		_i = (double) (_2 + _j);
		bvirt = (double) (_i - _2);
		avirt = _i - bvirt;
		bround = _j - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _i);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _i - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_i = (double) (_1 + _k);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _k - bvirt;
		around = _1 - avirt;
		cxby[4] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		cxby[5] = around + bround;
		cxby7 = (double) (_m + _k);
		bvirt = (double) (cxby7 - _m);
		avirt = cxby7 - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		cxby[6] = around + bround;

		cxby[7] = cxby7;
		c = (double) (splitter * cdxtail);
		abig = (double) (c - cdxtail);
		a0hi = c - abig;
		a0lo = cdxtail - a0hi;
		c = (double) (splitter * adytail);
		abig = (double) (c - adytail);
		bhi = c - abig;
		blo = adytail - bhi;
		_i = (double) (cdxtail * adytail);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		cxay[0] = (a0lo * blo) - err3;
		c = (double) (splitter * cdx);
		abig = (double) (c - cdx);
		a1hi = c - abig;
		a1lo = cdx - a1hi;
		_j = (double) (cdx * adytail);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_k = (double) (_i + _0);
		bvirt = (double) (_k - _i);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_1 = around + bround;
		_l = (double) (_j + _k);
		bvirt = _l - _j;
		_2 = _k - bvirt;
		c = (double) (splitter * ady);
		abig = (double) (c - ady);
		bhi = c - abig;
		blo = ady - bhi;
		_i = (double) (cdxtail * ady);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		_0 = (a0lo * blo) - err3;
		_k = (double) (_1 + _0);
		bvirt = (double) (_k - _1);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		cxay[1] = around + bround;
		_j = (double) (_2 + _k);
		bvirt = (double) (_j - _2);
		avirt = _j - bvirt;
		bround = _k - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _j);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _j - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_j = (double) (cdx * ady);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_n = (double) (_i + _0);
		bvirt = (double) (_n - _i);
		avirt = _n - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_0 = around + bround;
		_i = (double) (_1 + _0);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		cxay[2] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_l = (double) (_m + _k);
		bvirt = (double) (_l - _m);
		avirt = _l - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		_2 = around + bround;
		_k = (double) (_j + _n);
		bvirt = (double) (_k - _j);
		avirt = _k - bvirt;
		bround = _n - bvirt;
		around = _j - avirt;
		_0 = around + bround;
		_j = (double) (_1 + _0);
		bvirt = (double) (_j - _1);
		avirt = _j - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		cxay[3] = around + bround;
		_i = (double) (_2 + _j);
		bvirt = (double) (_i - _2);
		avirt = _i - bvirt;
		bround = _j - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _i);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _i - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_i = (double) (_1 + _k);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _k - bvirt;
		around = _1 - avirt;
		cxay[4] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		cxay[5] = around + bround;
		cxay7 = (double) (_m + _k);
		bvirt = (double) (cxay7 - _m);
		avirt = cxay7 - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		cxay[6] = around + bround;

		cxay[7] = cxay7;
		negate = -cdy;
		negatetail = -cdytail;
		c = (double) (splitter * adxtail);
		abig = (double) (c - adxtail);
		a0hi = c - abig;
		a0lo = adxtail - a0hi;
		c = (double) (splitter * negatetail);
		abig = (double) (c - negatetail);
		bhi = c - abig;
		blo = negatetail - bhi;
		_i = (double) (adxtail * negatetail);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		axcy[0] = (a0lo * blo) - err3;
		c = (double) (splitter * adx);
		abig = (double) (c - adx);
		a1hi = c - abig;
		a1lo = adx - a1hi;
		_j = (double) (adx * negatetail);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_k = (double) (_i + _0);
		bvirt = (double) (_k - _i);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_1 = around + bround;
		_l = (double) (_j + _k);
		bvirt = _l - _j;
		_2 = _k - bvirt;
		c = (double) (splitter * negate);
		abig = (double) (c - negate);
		bhi = c - abig;
		blo = negate - bhi;
		_i = (double) (adxtail * negate);
		err1 = _i - (a0hi * bhi);
		err2 = err1 - (a0lo * bhi);
		err3 = err2 - (a0hi * blo);
		_0 = (a0lo * blo) - err3;
		_k = (double) (_1 + _0);
		bvirt = (double) (_k - _1);
		avirt = _k - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		axcy[1] = around + bround;
		_j = (double) (_2 + _k);
		bvirt = (double) (_j - _2);
		avirt = _j - bvirt;
		bround = _k - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _j);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _j - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_j = (double) (adx * negate);
		err1 = _j - (a1hi * bhi);
		err2 = err1 - (a1lo * bhi);
		err3 = err2 - (a1hi * blo);
		_0 = (a1lo * blo) - err3;
		_n = (double) (_i + _0);
		bvirt = (double) (_n - _i);
		avirt = _n - bvirt;
		bround = _0 - bvirt;
		around = _i - avirt;
		_0 = around + bround;
		_i = (double) (_1 + _0);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		axcy[2] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_l = (double) (_m + _k);
		bvirt = (double) (_l - _m);
		avirt = _l - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		_2 = around + bround;
		_k = (double) (_j + _n);
		bvirt = (double) (_k - _j);
		avirt = _k - bvirt;
		bround = _n - bvirt;
		around = _j - avirt;
		_0 = around + bround;
		_j = (double) (_1 + _0);
		bvirt = (double) (_j - _1);
		avirt = _j - bvirt;
		bround = _0 - bvirt;
		around = _1 - avirt;
		axcy[3] = around + bround;
		_i = (double) (_2 + _j);
		bvirt = (double) (_i - _2);
		avirt = _i - bvirt;
		bround = _j - bvirt;
		around = _2 - avirt;
		_1 = around + bround;
		_m = (double) (_l + _i);
		bvirt = (double) (_m - _l);
		avirt = _m - bvirt;
		bround = _i - bvirt;
		around = _l - avirt;
		_2 = around + bround;
		_i = (double) (_1 + _k);
		bvirt = (double) (_i - _1);
		avirt = _i - bvirt;
		bround = _k - bvirt;
		around = _1 - avirt;
		axcy[4] = around + bround;
		_k = (double) (_2 + _i);
		bvirt = (double) (_k - _2);
		avirt = _k - bvirt;
		bround = _i - bvirt;
		around = _2 - avirt;
		axcy[5] = around + bround;
		axcy7 = (double) (_m + _k);
		bvirt = (double) (axcy7 - _m);
		avirt = axcy7 - bvirt;
		bround = _k - bvirt;
		around = _m - avirt;
		axcy[6] = around + bround;

		axcy[7] = axcy7;

		temp16len = fast_expansion_sum_zeroelim(8, bxcy, 8, cxby, temp16);
		temp32len = scale_expansion_zeroelim(temp16len, temp16, adz, temp32);
		temp32tlen = scale_expansion_zeroelim(temp16len, temp16, adztail, temp32t);
		alen = fast_expansion_sum_zeroelim(temp32len, temp32, temp32tlen, temp32t, adet);

		temp16len = fast_expansion_sum_zeroelim(8, cxay, 8, axcy, temp16);
		temp32len = scale_expansion_zeroelim(temp16len, temp16, bdz, temp32);
		temp32tlen = scale_expansion_zeroelim(temp16len, temp16, bdztail, temp32t);
		blen = fast_expansion_sum_zeroelim(temp32len, temp32, temp32tlen, temp32t, bdet);

		temp16len = fast_expansion_sum_zeroelim(8, axby, 8, bxay, temp16);
		temp32len = scale_expansion_zeroelim(temp16len, temp16, cdz, temp32);
		temp32tlen = scale_expansion_zeroelim(temp16len, temp16, cdztail, temp32t);
		clen = fast_expansion_sum_zeroelim(temp32len, temp32, temp32tlen, temp32t, cdet);

		ablen = fast_expansion_sum_zeroelim(alen, adet, blen, bdet, abdet);
		deterlen = fast_expansion_sum_zeroelim(ablen, abdet, clen, cdet, deter);

		return deter[deterlen - 1];
	}

	static double orient3dadapt(double[] pa, double[] pb, double[] pc, double[] pd, double permanent) {
		double adx, bdx, cdx, ady, bdy, cdy, adz, bdz, cdz;
		double det, errbound;

		double bdxcdy1, cdxbdy1, cdxady1, adxcdy1, adxbdy1, bdxady1;
		double bdxcdy0, cdxbdy0, cdxady0, adxcdy0, adxbdy0, bdxady0;
		double[] bc = new double[4], ca = new double[4], ab = new double[4];
		double bc3, ca3, ab3;
		double[] adet = new double[8], bdet = new double[8], cdet = new double[8];
		int alen, blen, clen;
		double[] abdet = new double[16];
		int ablen;
		double[] finnow, finother, finswap;
		double[] fin1 = new double[192], fin2 = new double[192];
		int finlength;

		double adxtail, bdxtail, cdxtail;
		double adytail, bdytail, cdytail;
		double adztail, bdztail, cdztail;
		double at_blarge, at_clarge;
		double bt_clarge, bt_alarge;
		double ct_alarge, ct_blarge;
		double[] at_b = new double[4], at_c = new double[4], bt_c = new double[4], bt_a = new double[4], ct_a = new double[4], ct_b = new double[4];
		int at_blen, at_clen, bt_clen, bt_alen, ct_alen, ct_blen;
		double bdxt_cdy1, cdxt_bdy1, cdxt_ady1;
		double adxt_cdy1, adxt_bdy1, bdxt_ady1;
		double bdxt_cdy0, cdxt_bdy0, cdxt_ady0;
		double adxt_cdy0, adxt_bdy0, bdxt_ady0;
		double bdyt_cdx1, cdyt_bdx1, cdyt_adx1;
		double adyt_cdx1, adyt_bdx1, bdyt_adx1;
		double bdyt_cdx0, cdyt_bdx0, cdyt_adx0;
		double adyt_cdx0, adyt_bdx0, bdyt_adx0;
		double[] bct = new double[8], cat = new double[8], abt = new double[8];
		int bctlen, catlen, abtlen;
		double bdxt_cdyt1, cdxt_bdyt1, cdxt_adyt1;
		double adxt_cdyt1, adxt_bdyt1, bdxt_adyt1;
		double bdxt_cdyt0, cdxt_bdyt0, cdxt_adyt0;
		double adxt_cdyt0, adxt_bdyt0, bdxt_adyt0;
		double[] u = new double[4], v = new double[12], w = new double[16];
		double u3;
		int vlength, wlength;
		double negate;

		double bvirt;
		double avirt, bround, around;
		double c;
		double abig;
		double ahi, alo, bhi, blo;
		double err1, err2, err3;
		double _i, _j, _k;
		double _0;

		adx = (double) (pa[0] - pd[0]);
		bdx = (double) (pb[0] - pd[0]);
		cdx = (double) (pc[0] - pd[0]);
		ady = (double) (pa[1] - pd[1]);
		bdy = (double) (pb[1] - pd[1]);
		cdy = (double) (pc[1] - pd[1]);
		adz = (double) (pa[2] - pd[2]);
		bdz = (double) (pb[2] - pd[2]);
		cdz = (double) (pc[2] - pd[2]);

		bdxcdy1 = (double) (bdx * cdy);
		c = (double) (splitter * bdx);
		abig = (double) (c - bdx);
		ahi = c - abig;
		alo = bdx - ahi;
		c = (double) (splitter * cdy);
		abig = (double) (c - cdy);
		bhi = c - abig;
		blo = cdy - bhi;
		err1 = bdxcdy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		bdxcdy0 = (alo * blo) - err3;
		cdxbdy1 = (double) (cdx * bdy);
		c = (double) (splitter * cdx);
		abig = (double) (c - cdx);
		ahi = c - abig;
		alo = cdx - ahi;
		c = (double) (splitter * bdy);
		abig = (double) (c - bdy);
		bhi = c - abig;
		blo = bdy - bhi;
		err1 = cdxbdy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		cdxbdy0 = (alo * blo) - err3;
		_i = (double) (bdxcdy0 - cdxbdy0);
		bvirt = (double) (bdxcdy0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - cdxbdy0;
		around = bdxcdy0 - avirt;
		bc[0] = around + bround;
		_j = (double) (bdxcdy1 + _i);
		bvirt = (double) (_j - bdxcdy1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = bdxcdy1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - cdxbdy1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - cdxbdy1;
		around = _0 - avirt;
		bc[1] = around + bround;
		bc3 = (double) (_j + _i);
		bvirt = (double) (bc3 - _j);
		avirt = bc3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		bc[2] = around + bround;
		bc[3] = bc3;
		alen = scale_expansion_zeroelim(4, bc, adz, adet);

		cdxady1 = (double) (cdx * ady);
		c = (double) (splitter * cdx);
		abig = (double) (c - cdx);
		ahi = c - abig;
		alo = cdx - ahi;
		c = (double) (splitter * ady);
		abig = (double) (c - ady);
		bhi = c - abig;
		blo = ady - bhi;
		err1 = cdxady1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		cdxady0 = (alo * blo) - err3;
		adxcdy1 = (double) (adx * cdy);
		c = (double) (splitter * adx);
		abig = (double) (c - adx);
		ahi = c - abig;
		alo = adx - ahi;
		c = (double) (splitter * cdy);
		abig = (double) (c - cdy);
		bhi = c - abig;
		blo = cdy - bhi;
		err1 = adxcdy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		adxcdy0 = (alo * blo) - err3;
		_i = (double) (cdxady0 - adxcdy0);
		bvirt = (double) (cdxady0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - adxcdy0;
		around = cdxady0 - avirt;
		ca[0] = around + bround;
		_j = (double) (cdxady1 + _i);
		bvirt = (double) (_j - cdxady1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = cdxady1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - adxcdy1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - adxcdy1;
		around = _0 - avirt;
		ca[1] = around + bround;
		ca3 = (double) (_j + _i);
		bvirt = (double) (ca3 - _j);
		avirt = ca3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		ca[2] = around + bround;
		ca[3] = ca3;
		blen = scale_expansion_zeroelim(4, ca, bdz, bdet);

		adxbdy1 = (double) (adx * bdy);
		c = (double) (splitter * adx);
		abig = (double) (c - adx);
		ahi = c - abig;
		alo = adx - ahi;
		c = (double) (splitter * bdy);
		abig = (double) (c - bdy);
		bhi = c - abig;
		blo = bdy - bhi;
		err1 = adxbdy1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		adxbdy0 = (alo * blo) - err3;
		bdxady1 = (double) (bdx * ady);
		c = (double) (splitter * bdx);
		abig = (double) (c - bdx);
		ahi = c - abig;
		alo = bdx - ahi;
		c = (double) (splitter * ady);
		abig = (double) (c - ady);
		bhi = c - abig;
		blo = ady - bhi;
		err1 = bdxady1 - (ahi * bhi);
		err2 = err1 - (alo * bhi);
		err3 = err2 - (ahi * blo);
		bdxady0 = (alo * blo) - err3;
		_i = (double) (adxbdy0 - bdxady0);
		bvirt = (double) (adxbdy0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - bdxady0;
		around = adxbdy0 - avirt;
		ab[0] = around + bround;
		_j = (double) (adxbdy1 + _i);
		bvirt = (double) (_j - adxbdy1);
		avirt = _j - bvirt;
		bround = _i - bvirt;
		around = adxbdy1 - avirt;
		_0 = around + bround;
		_i = (double) (_0 - bdxady1);
		bvirt = (double) (_0 - _i);
		avirt = _i + bvirt;
		bround = bvirt - bdxady1;
		around = _0 - avirt;
		ab[1] = around + bround;
		ab3 = (double) (_j + _i);
		bvirt = (double) (ab3 - _j);
		avirt = ab3 - bvirt;
		bround = _i - bvirt;
		around = _j - avirt;
		ab[2] = around + bround;
		ab[3] = ab3;
		clen = scale_expansion_zeroelim(4, ab, cdz, cdet);

		ablen = fast_expansion_sum_zeroelim(alen, adet, blen, bdet, abdet);
		finlength = fast_expansion_sum_zeroelim(ablen, abdet, clen, cdet, fin1);

		det = estimate(finlength, fin1);
		errbound = o3derrboundB * permanent;
		if ((det >= errbound) || (-det >= errbound)) {
			return det;
		}

		bvirt = (double) (pa[0] - adx);
		avirt = adx + bvirt;
		bround = bvirt - pd[0];
		around = pa[0] - avirt;
		adxtail = around + bround;
		bvirt = (double) (pb[0] - bdx);
		avirt = bdx + bvirt;
		bround = bvirt - pd[0];
		around = pb[0] - avirt;
		bdxtail = around + bround;
		bvirt = (double) (pc[0] - cdx);
		avirt = cdx + bvirt;
		bround = bvirt - pd[0];
		around = pc[0] - avirt;
		cdxtail = around + bround;
		bvirt = (double) (pa[1] - ady);
		avirt = ady + bvirt;
		bround = bvirt - pd[1];
		around = pa[1] - avirt;
		adytail = around + bround;
		bvirt = (double) (pb[1] - bdy);
		avirt = bdy + bvirt;
		bround = bvirt - pd[1];
		around = pb[1] - avirt;
		bdytail = around + bround;
		bvirt = (double) (pc[1] - cdy);
		avirt = cdy + bvirt;
		bround = bvirt - pd[1];
		around = pc[1] - avirt;
		cdytail = around + bround;
		bvirt = (double) (pa[2] - adz);
		avirt = adz + bvirt;
		bround = bvirt - pd[2];
		around = pa[2] - avirt;
		adztail = around + bround;
		bvirt = (double) (pb[2] - bdz);
		avirt = bdz + bvirt;
		bround = bvirt - pd[2];
		around = pb[2] - avirt;
		bdztail = around + bround;
		bvirt = (double) (pc[2] - cdz);
		avirt = cdz + bvirt;
		bround = bvirt - pd[2];
		around = pc[2] - avirt;
		cdztail = around + bround;

		if ((adxtail == 0.0) && (bdxtail == 0.0) && (cdxtail == 0.0) && (adytail == 0.0) && (bdytail == 0.0) && (cdytail == 0.0) && (adztail == 0.0)
				&& (bdztail == 0.0) && (cdztail == 0.0)) {
			return det;
		}

		errbound = o3derrboundC * permanent + resulterrbound * ((det) >= 0.0 ? (det) : -(det));
		det += (adz * ((bdx * cdytail + cdy * bdxtail) - (bdy * cdxtail + cdx * bdytail)) + adztail * (bdx * cdy - bdy * cdx))
				+ (bdz * ((cdx * adytail + ady * cdxtail) - (cdy * adxtail + adx * cdytail)) + bdztail * (cdx * ady - cdy * adx))
				+ (cdz * ((adx * bdytail + bdy * adxtail) - (ady * bdxtail + bdx * adytail)) + cdztail * (adx * bdy - ady * bdx));
		if ((det >= errbound) || (-det >= errbound)) {
			return det;
		}

		finnow = fin1;
		finother = fin2;

		if (adxtail == 0.0) {
			if (adytail == 0.0) {
				at_b[0] = 0.0;
				at_blen = 1;
				at_c[0] = 0.0;
				at_clen = 1;
			} else {
				negate = -adytail;
				at_blarge = (double) (negate * bdx);
				c = (double) (splitter * negate);
				abig = (double) (c - negate);
				ahi = c - abig;
				alo = negate - ahi;
				c = (double) (splitter * bdx);
				abig = (double) (c - bdx);
				bhi = c - abig;
				blo = bdx - bhi;
				err1 = at_blarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				at_b[0] = (alo * blo) - err3;
				at_b[1] = at_blarge;
				at_blen = 2;
				at_clarge = (double) (adytail * cdx);
				c = (double) (splitter * adytail);
				abig = (double) (c - adytail);
				ahi = c - abig;
				alo = adytail - ahi;
				c = (double) (splitter * cdx);
				abig = (double) (c - cdx);
				bhi = c - abig;
				blo = cdx - bhi;
				err1 = at_clarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				at_c[0] = (alo * blo) - err3;
				at_c[1] = at_clarge;
				at_clen = 2;
			}
		} else {
			if (adytail == 0.0) {
				at_blarge = (double) (adxtail * bdy);
				c = (double) (splitter * adxtail);
				abig = (double) (c - adxtail);
				ahi = c - abig;
				alo = adxtail - ahi;
				c = (double) (splitter * bdy);
				abig = (double) (c - bdy);
				bhi = c - abig;
				blo = bdy - bhi;
				err1 = at_blarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				at_b[0] = (alo * blo) - err3;
				at_b[1] = at_blarge;
				at_blen = 2;
				negate = -adxtail;
				at_clarge = (double) (negate * cdy);
				c = (double) (splitter * negate);
				abig = (double) (c - negate);
				ahi = c - abig;
				alo = negate - ahi;
				c = (double) (splitter * cdy);
				abig = (double) (c - cdy);
				bhi = c - abig;
				blo = cdy - bhi;
				err1 = at_clarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				at_c[0] = (alo * blo) - err3;
				at_c[1] = at_clarge;
				at_clen = 2;
			} else {
				adxt_bdy1 = (double) (adxtail * bdy);
				c = (double) (splitter * adxtail);
				abig = (double) (c - adxtail);
				ahi = c - abig;
				alo = adxtail - ahi;
				c = (double) (splitter * bdy);
				abig = (double) (c - bdy);
				bhi = c - abig;
				blo = bdy - bhi;
				err1 = adxt_bdy1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				adxt_bdy0 = (alo * blo) - err3;
				adyt_bdx1 = (double) (adytail * bdx);
				c = (double) (splitter * adytail);
				abig = (double) (c - adytail);
				ahi = c - abig;
				alo = adytail - ahi;
				c = (double) (splitter * bdx);
				abig = (double) (c - bdx);
				bhi = c - abig;
				blo = bdx - bhi;
				err1 = adyt_bdx1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				adyt_bdx0 = (alo * blo) - err3;
				_i = (double) (adxt_bdy0 - adyt_bdx0);
				bvirt = (double) (adxt_bdy0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - adyt_bdx0;
				around = adxt_bdy0 - avirt;
				at_b[0] = around + bround;
				_j = (double) (adxt_bdy1 + _i);
				bvirt = (double) (_j - adxt_bdy1);
				avirt = _j - bvirt;
				bround = _i - bvirt;
				around = adxt_bdy1 - avirt;
				_0 = around + bround;
				_i = (double) (_0 - adyt_bdx1);
				bvirt = (double) (_0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - adyt_bdx1;
				around = _0 - avirt;
				at_b[1] = around + bround;
				at_blarge = (double) (_j + _i);
				bvirt = (double) (at_blarge - _j);
				avirt = at_blarge - bvirt;
				bround = _i - bvirt;
				around = _j - avirt;
				at_b[2] = around + bround;

				at_b[3] = at_blarge;
				at_blen = 4;
				adyt_cdx1 = (double) (adytail * cdx);
				c = (double) (splitter * adytail);
				abig = (double) (c - adytail);
				ahi = c - abig;
				alo = adytail - ahi;
				c = (double) (splitter * cdx);
				abig = (double) (c - cdx);
				bhi = c - abig;
				blo = cdx - bhi;
				err1 = adyt_cdx1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				adyt_cdx0 = (alo * blo) - err3;
				adxt_cdy1 = (double) (adxtail * cdy);
				c = (double) (splitter * adxtail);
				abig = (double) (c - adxtail);
				ahi = c - abig;
				alo = adxtail - ahi;
				c = (double) (splitter * cdy);
				abig = (double) (c - cdy);
				bhi = c - abig;
				blo = cdy - bhi;
				err1 = adxt_cdy1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				adxt_cdy0 = (alo * blo) - err3;
				_i = (double) (adyt_cdx0 - adxt_cdy0);
				bvirt = (double) (adyt_cdx0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - adxt_cdy0;
				around = adyt_cdx0 - avirt;
				at_c[0] = around + bround;
				_j = (double) (adyt_cdx1 + _i);
				bvirt = (double) (_j - adyt_cdx1);
				avirt = _j - bvirt;
				bround = _i - bvirt;
				around = adyt_cdx1 - avirt;
				_0 = around + bround;
				_i = (double) (_0 - adxt_cdy1);
				bvirt = (double) (_0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - adxt_cdy1;
				around = _0 - avirt;
				at_c[1] = around + bround;
				at_clarge = (double) (_j + _i);
				bvirt = (double) (at_clarge - _j);
				avirt = at_clarge - bvirt;
				bround = _i - bvirt;
				around = _j - avirt;
				at_c[2] = around + bround;

				at_c[3] = at_clarge;
				at_clen = 4;
			}
		}
		if (bdxtail == 0.0) {
			if (bdytail == 0.0) {
				bt_c[0] = 0.0;
				bt_clen = 1;
				bt_a[0] = 0.0;
				bt_alen = 1;
			} else {
				negate = -bdytail;
				bt_clarge = (double) (negate * cdx);
				c = (double) (splitter * negate);
				abig = (double) (c - negate);
				ahi = c - abig;
				alo = negate - ahi;
				c = (double) (splitter * cdx);
				abig = (double) (c - cdx);
				bhi = c - abig;
				blo = cdx - bhi;
				err1 = bt_clarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bt_c[0] = (alo * blo) - err3;
				bt_c[1] = bt_clarge;
				bt_clen = 2;
				bt_alarge = (double) (bdytail * adx);
				c = (double) (splitter * bdytail);
				abig = (double) (c - bdytail);
				ahi = c - abig;
				alo = bdytail - ahi;
				c = (double) (splitter * adx);
				abig = (double) (c - adx);
				bhi = c - abig;
				blo = adx - bhi;
				err1 = bt_alarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bt_a[0] = (alo * blo) - err3;
				bt_a[1] = bt_alarge;
				bt_alen = 2;
			}
		} else {
			if (bdytail == 0.0) {
				bt_clarge = (double) (bdxtail * cdy);
				c = (double) (splitter * bdxtail);
				abig = (double) (c - bdxtail);
				ahi = c - abig;
				alo = bdxtail - ahi;
				c = (double) (splitter * cdy);
				abig = (double) (c - cdy);
				bhi = c - abig;
				blo = cdy - bhi;
				err1 = bt_clarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bt_c[0] = (alo * blo) - err3;
				bt_c[1] = bt_clarge;
				bt_clen = 2;
				negate = -bdxtail;
				bt_alarge = (double) (negate * ady);
				c = (double) (splitter * negate);
				abig = (double) (c - negate);
				ahi = c - abig;
				alo = negate - ahi;
				c = (double) (splitter * ady);
				abig = (double) (c - ady);
				bhi = c - abig;
				blo = ady - bhi;
				err1 = bt_alarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bt_a[0] = (alo * blo) - err3;
				bt_a[1] = bt_alarge;
				bt_alen = 2;
			} else {
				bdxt_cdy1 = (double) (bdxtail * cdy);
				c = (double) (splitter * bdxtail);
				abig = (double) (c - bdxtail);
				ahi = c - abig;
				alo = bdxtail - ahi;
				c = (double) (splitter * cdy);
				abig = (double) (c - cdy);
				bhi = c - abig;
				blo = cdy - bhi;
				err1 = bdxt_cdy1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bdxt_cdy0 = (alo * blo) - err3;
				bdyt_cdx1 = (double) (bdytail * cdx);
				c = (double) (splitter * bdytail);
				abig = (double) (c - bdytail);
				ahi = c - abig;
				alo = bdytail - ahi;
				c = (double) (splitter * cdx);
				abig = (double) (c - cdx);
				bhi = c - abig;
				blo = cdx - bhi;
				err1 = bdyt_cdx1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bdyt_cdx0 = (alo * blo) - err3;
				_i = (double) (bdxt_cdy0 - bdyt_cdx0);
				bvirt = (double) (bdxt_cdy0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - bdyt_cdx0;
				around = bdxt_cdy0 - avirt;
				bt_c[0] = around + bround;
				_j = (double) (bdxt_cdy1 + _i);
				bvirt = (double) (_j - bdxt_cdy1);
				avirt = _j - bvirt;
				bround = _i - bvirt;
				around = bdxt_cdy1 - avirt;
				_0 = around + bround;
				_i = (double) (_0 - bdyt_cdx1);
				bvirt = (double) (_0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - bdyt_cdx1;
				around = _0 - avirt;
				bt_c[1] = around + bround;
				bt_clarge = (double) (_j + _i);
				bvirt = (double) (bt_clarge - _j);
				avirt = bt_clarge - bvirt;
				bround = _i - bvirt;
				around = _j - avirt;
				bt_c[2] = around + bround;

				bt_c[3] = bt_clarge;
				bt_clen = 4;
				bdyt_adx1 = (double) (bdytail * adx);
				c = (double) (splitter * bdytail);
				abig = (double) (c - bdytail);
				ahi = c - abig;
				alo = bdytail - ahi;
				c = (double) (splitter * adx);
				abig = (double) (c - adx);
				bhi = c - abig;
				blo = adx - bhi;
				err1 = bdyt_adx1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bdyt_adx0 = (alo * blo) - err3;
				bdxt_ady1 = (double) (bdxtail * ady);
				c = (double) (splitter * bdxtail);
				abig = (double) (c - bdxtail);
				ahi = c - abig;
				alo = bdxtail - ahi;
				c = (double) (splitter * ady);
				abig = (double) (c - ady);
				bhi = c - abig;
				blo = ady - bhi;
				err1 = bdxt_ady1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bdxt_ady0 = (alo * blo) - err3;
				_i = (double) (bdyt_adx0 - bdxt_ady0);
				bvirt = (double) (bdyt_adx0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - bdxt_ady0;
				around = bdyt_adx0 - avirt;
				bt_a[0] = around + bround;
				_j = (double) (bdyt_adx1 + _i);
				bvirt = (double) (_j - bdyt_adx1);
				avirt = _j - bvirt;
				bround = _i - bvirt;
				around = bdyt_adx1 - avirt;
				_0 = around + bround;
				_i = (double) (_0 - bdxt_ady1);
				bvirt = (double) (_0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - bdxt_ady1;
				around = _0 - avirt;
				bt_a[1] = around + bround;
				bt_alarge = (double) (_j + _i);
				bvirt = (double) (bt_alarge - _j);
				avirt = bt_alarge - bvirt;
				bround = _i - bvirt;
				around = _j - avirt;
				bt_a[2] = around + bround;

				bt_a[3] = bt_alarge;
				bt_alen = 4;
			}
		}
		if (cdxtail == 0.0) {
			if (cdytail == 0.0) {
				ct_a[0] = 0.0;
				ct_alen = 1;
				ct_b[0] = 0.0;
				ct_blen = 1;
			} else {
				negate = -cdytail;
				ct_alarge = (double) (negate * adx);
				c = (double) (splitter * negate);
				abig = (double) (c - negate);
				ahi = c - abig;
				alo = negate - ahi;
				c = (double) (splitter * adx);
				abig = (double) (c - adx);
				bhi = c - abig;
				blo = adx - bhi;
				err1 = ct_alarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				ct_a[0] = (alo * blo) - err3;
				ct_a[1] = ct_alarge;
				ct_alen = 2;
				ct_blarge = (double) (cdytail * bdx);
				c = (double) (splitter * cdytail);
				abig = (double) (c - cdytail);
				ahi = c - abig;
				alo = cdytail - ahi;
				c = (double) (splitter * bdx);
				abig = (double) (c - bdx);
				bhi = c - abig;
				blo = bdx - bhi;
				err1 = ct_blarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				ct_b[0] = (alo * blo) - err3;
				ct_b[1] = ct_blarge;
				ct_blen = 2;
			}
		} else {
			if (cdytail == 0.0) {
				ct_alarge = (double) (cdxtail * ady);
				c = (double) (splitter * cdxtail);
				abig = (double) (c - cdxtail);
				ahi = c - abig;
				alo = cdxtail - ahi;
				c = (double) (splitter * ady);
				abig = (double) (c - ady);
				bhi = c - abig;
				blo = ady - bhi;
				err1 = ct_alarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				ct_a[0] = (alo * blo) - err3;
				ct_a[1] = ct_alarge;
				ct_alen = 2;
				negate = -cdxtail;
				ct_blarge = (double) (negate * bdy);
				c = (double) (splitter * negate);
				abig = (double) (c - negate);
				ahi = c - abig;
				alo = negate - ahi;
				c = (double) (splitter * bdy);
				abig = (double) (c - bdy);
				bhi = c - abig;
				blo = bdy - bhi;
				err1 = ct_blarge - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				ct_b[0] = (alo * blo) - err3;
				ct_b[1] = ct_blarge;
				ct_blen = 2;
			} else {
				cdxt_ady1 = (double) (cdxtail * ady);
				c = (double) (splitter * cdxtail);
				abig = (double) (c - cdxtail);
				ahi = c - abig;
				alo = cdxtail - ahi;
				c = (double) (splitter * ady);
				abig = (double) (c - ady);
				bhi = c - abig;
				blo = ady - bhi;
				err1 = cdxt_ady1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				cdxt_ady0 = (alo * blo) - err3;
				cdyt_adx1 = (double) (cdytail * adx);
				c = (double) (splitter * cdytail);
				abig = (double) (c - cdytail);
				ahi = c - abig;
				alo = cdytail - ahi;
				c = (double) (splitter * adx);
				abig = (double) (c - adx);
				bhi = c - abig;
				blo = adx - bhi;
				err1 = cdyt_adx1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				cdyt_adx0 = (alo * blo) - err3;
				_i = (double) (cdxt_ady0 - cdyt_adx0);
				bvirt = (double) (cdxt_ady0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - cdyt_adx0;
				around = cdxt_ady0 - avirt;
				ct_a[0] = around + bround;
				_j = (double) (cdxt_ady1 + _i);
				bvirt = (double) (_j - cdxt_ady1);
				avirt = _j - bvirt;
				bround = _i - bvirt;
				around = cdxt_ady1 - avirt;
				_0 = around + bround;
				_i = (double) (_0 - cdyt_adx1);
				bvirt = (double) (_0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - cdyt_adx1;
				around = _0 - avirt;
				ct_a[1] = around + bround;
				ct_alarge = (double) (_j + _i);
				bvirt = (double) (ct_alarge - _j);
				avirt = ct_alarge - bvirt;
				bround = _i - bvirt;
				around = _j - avirt;
				ct_a[2] = around + bround;

				ct_a[3] = ct_alarge;
				ct_alen = 4;
				cdyt_bdx1 = (double) (cdytail * bdx);
				c = (double) (splitter * cdytail);
				abig = (double) (c - cdytail);
				ahi = c - abig;
				alo = cdytail - ahi;
				c = (double) (splitter * bdx);
				abig = (double) (c - bdx);
				bhi = c - abig;
				blo = bdx - bhi;
				err1 = cdyt_bdx1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				cdyt_bdx0 = (alo * blo) - err3;
				cdxt_bdy1 = (double) (cdxtail * bdy);
				c = (double) (splitter * cdxtail);
				abig = (double) (c - cdxtail);
				ahi = c - abig;
				alo = cdxtail - ahi;
				c = (double) (splitter * bdy);
				abig = (double) (c - bdy);
				bhi = c - abig;
				blo = bdy - bhi;
				err1 = cdxt_bdy1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				cdxt_bdy0 = (alo * blo) - err3;
				_i = (double) (cdyt_bdx0 - cdxt_bdy0);
				bvirt = (double) (cdyt_bdx0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - cdxt_bdy0;
				around = cdyt_bdx0 - avirt;
				ct_b[0] = around + bround;
				_j = (double) (cdyt_bdx1 + _i);
				bvirt = (double) (_j - cdyt_bdx1);
				avirt = _j - bvirt;
				bround = _i - bvirt;
				around = cdyt_bdx1 - avirt;
				_0 = around + bround;
				_i = (double) (_0 - cdxt_bdy1);
				bvirt = (double) (_0 - _i);
				avirt = _i + bvirt;
				bround = bvirt - cdxt_bdy1;
				around = _0 - avirt;
				ct_b[1] = around + bround;
				ct_blarge = (double) (_j + _i);
				bvirt = (double) (ct_blarge - _j);
				avirt = ct_blarge - bvirt;
				bround = _i - bvirt;
				around = _j - avirt;
				ct_b[2] = around + bround;

				ct_b[3] = ct_blarge;
				ct_blen = 4;
			}
		}

		bctlen = fast_expansion_sum_zeroelim(bt_clen, bt_c, ct_blen, ct_b, bct);
		wlength = scale_expansion_zeroelim(bctlen, bct, adz, w);
		finlength = fast_expansion_sum_zeroelim(finlength, finnow, wlength, w, finother);
		finswap = finnow;
		finnow = finother;
		finother = finswap;

		catlen = fast_expansion_sum_zeroelim(ct_alen, ct_a, at_clen, at_c, cat);
		wlength = scale_expansion_zeroelim(catlen, cat, bdz, w);
		finlength = fast_expansion_sum_zeroelim(finlength, finnow, wlength, w, finother);
		finswap = finnow;
		finnow = finother;
		finother = finswap;

		abtlen = fast_expansion_sum_zeroelim(at_blen, at_b, bt_alen, bt_a, abt);
		wlength = scale_expansion_zeroelim(abtlen, abt, cdz, w);
		finlength = fast_expansion_sum_zeroelim(finlength, finnow, wlength, w, finother);
		finswap = finnow;
		finnow = finother;
		finother = finswap;

		if (adztail != 0.0) {
			vlength = scale_expansion_zeroelim(4, bc, adztail, v);
			finlength = fast_expansion_sum_zeroelim(finlength, finnow, vlength, v, finother);
			finswap = finnow;
			finnow = finother;
			finother = finswap;
		}
		if (bdztail != 0.0) {
			vlength = scale_expansion_zeroelim(4, ca, bdztail, v);
			finlength = fast_expansion_sum_zeroelim(finlength, finnow, vlength, v, finother);
			finswap = finnow;
			finnow = finother;
			finother = finswap;
		}
		if (cdztail != 0.0) {
			vlength = scale_expansion_zeroelim(4, ab, cdztail, v);
			finlength = fast_expansion_sum_zeroelim(finlength, finnow, vlength, v, finother);
			finswap = finnow;
			finnow = finother;
			finother = finswap;
		}

		if (adxtail != 0.0) {
			if (bdytail != 0.0) {
				adxt_bdyt1 = (double) (adxtail * bdytail);
				c = (double) (splitter * adxtail);
				abig = (double) (c - adxtail);
				ahi = c - abig;
				alo = adxtail - ahi;
				c = (double) (splitter * bdytail);
				abig = (double) (c - bdytail);
				bhi = c - abig;
				blo = bdytail - bhi;
				err1 = adxt_bdyt1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				adxt_bdyt0 = (alo * blo) - err3;
				c = (double) (splitter * cdz);
				abig = (double) (c - cdz);
				bhi = c - abig;
				blo = cdz - bhi;
				_i = (double) (adxt_bdyt0 * cdz);
				c = (double) (splitter * adxt_bdyt0);
				abig = (double) (c - adxt_bdyt0);
				ahi = c - abig;
				alo = adxt_bdyt0 - ahi;
				err1 = _i - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				u[0] = (alo * blo) - err3;
				_j = (double) (adxt_bdyt1 * cdz);
				c = (double) (splitter * adxt_bdyt1);
				abig = (double) (c - adxt_bdyt1);
				ahi = c - abig;
				alo = adxt_bdyt1 - ahi;
				err1 = _j - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				_0 = (alo * blo) - err3;
				_k = (double) (_i + _0);
				bvirt = (double) (_k - _i);
				avirt = _k - bvirt;
				bround = _0 - bvirt;
				around = _i - avirt;
				u[1] = around + bround;
				u3 = (double) (_j + _k);
				bvirt = u3 - _j;
				u[2] = _k - bvirt;
				u[3] = u3;
				finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
				finswap = finnow;
				finnow = finother;
				finother = finswap;
				if (cdztail != 0.0) {
					c = (double) (splitter * cdztail);
					abig = (double) (c - cdztail);
					bhi = c - abig;
					blo = cdztail - bhi;
					_i = (double) (adxt_bdyt0 * cdztail);
					c = (double) (splitter * adxt_bdyt0);
					abig = (double) (c - adxt_bdyt0);
					ahi = c - abig;
					alo = adxt_bdyt0 - ahi;
					err1 = _i - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					u[0] = (alo * blo) - err3;
					_j = (double) (adxt_bdyt1 * cdztail);
					c = (double) (splitter * adxt_bdyt1);
					abig = (double) (c - adxt_bdyt1);
					ahi = c - abig;
					alo = adxt_bdyt1 - ahi;
					err1 = _j - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					_0 = (alo * blo) - err3;
					_k = (double) (_i + _0);
					bvirt = (double) (_k - _i);
					avirt = _k - bvirt;
					bround = _0 - bvirt;
					around = _i - avirt;
					u[1] = around + bround;
					u3 = (double) (_j + _k);
					bvirt = u3 - _j;
					u[2] = _k - bvirt;
					u[3] = u3;
					finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
					finswap = finnow;
					finnow = finother;
					finother = finswap;
				}
			}
			if (cdytail != 0.0) {
				negate = -adxtail;
				adxt_cdyt1 = (double) (negate * cdytail);
				c = (double) (splitter * negate);
				abig = (double) (c - negate);
				ahi = c - abig;
				alo = negate - ahi;
				c = (double) (splitter * cdytail);
				abig = (double) (c - cdytail);
				bhi = c - abig;
				blo = cdytail - bhi;
				err1 = adxt_cdyt1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				adxt_cdyt0 = (alo * blo) - err3;
				c = (double) (splitter * bdz);
				abig = (double) (c - bdz);
				bhi = c - abig;
				blo = bdz - bhi;
				_i = (double) (adxt_cdyt0 * bdz);
				c = (double) (splitter * adxt_cdyt0);
				abig = (double) (c - adxt_cdyt0);
				ahi = c - abig;
				alo = adxt_cdyt0 - ahi;
				err1 = _i - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				u[0] = (alo * blo) - err3;
				_j = (double) (adxt_cdyt1 * bdz);
				c = (double) (splitter * adxt_cdyt1);
				abig = (double) (c - adxt_cdyt1);
				ahi = c - abig;
				alo = adxt_cdyt1 - ahi;
				err1 = _j - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				_0 = (alo * blo) - err3;
				_k = (double) (_i + _0);
				bvirt = (double) (_k - _i);
				avirt = _k - bvirt;
				bround = _0 - bvirt;
				around = _i - avirt;
				u[1] = around + bround;
				u3 = (double) (_j + _k);
				bvirt = u3 - _j;
				u[2] = _k - bvirt;
				u[3] = u3;
				finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
				finswap = finnow;
				finnow = finother;
				finother = finswap;
				if (bdztail != 0.0) {
					c = (double) (splitter * bdztail);
					abig = (double) (c - bdztail);
					bhi = c - abig;
					blo = bdztail - bhi;
					_i = (double) (adxt_cdyt0 * bdztail);
					c = (double) (splitter * adxt_cdyt0);
					abig = (double) (c - adxt_cdyt0);
					ahi = c - abig;
					alo = adxt_cdyt0 - ahi;
					err1 = _i - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					u[0] = (alo * blo) - err3;
					_j = (double) (adxt_cdyt1 * bdztail);
					c = (double) (splitter * adxt_cdyt1);
					abig = (double) (c - adxt_cdyt1);
					ahi = c - abig;
					alo = adxt_cdyt1 - ahi;
					err1 = _j - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					_0 = (alo * blo) - err3;
					_k = (double) (_i + _0);
					bvirt = (double) (_k - _i);
					avirt = _k - bvirt;
					bround = _0 - bvirt;
					around = _i - avirt;
					u[1] = around + bround;
					u3 = (double) (_j + _k);
					bvirt = u3 - _j;
					u[2] = _k - bvirt;
					u[3] = u3;
					finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
					finswap = finnow;
					finnow = finother;
					finother = finswap;
				}
			}
		}
		if (bdxtail != 0.0) {
			if (cdytail != 0.0) {
				bdxt_cdyt1 = (double) (bdxtail * cdytail);
				c = (double) (splitter * bdxtail);
				abig = (double) (c - bdxtail);
				ahi = c - abig;
				alo = bdxtail - ahi;
				c = (double) (splitter * cdytail);
				abig = (double) (c - cdytail);
				bhi = c - abig;
				blo = cdytail - bhi;
				err1 = bdxt_cdyt1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bdxt_cdyt0 = (alo * blo) - err3;
				c = (double) (splitter * adz);
				abig = (double) (c - adz);
				bhi = c - abig;
				blo = adz - bhi;
				_i = (double) (bdxt_cdyt0 * adz);
				c = (double) (splitter * bdxt_cdyt0);
				abig = (double) (c - bdxt_cdyt0);
				ahi = c - abig;
				alo = bdxt_cdyt0 - ahi;
				err1 = _i - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				u[0] = (alo * blo) - err3;
				_j = (double) (bdxt_cdyt1 * adz);
				c = (double) (splitter * bdxt_cdyt1);
				abig = (double) (c - bdxt_cdyt1);
				ahi = c - abig;
				alo = bdxt_cdyt1 - ahi;
				err1 = _j - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				_0 = (alo * blo) - err3;
				_k = (double) (_i + _0);
				bvirt = (double) (_k - _i);
				avirt = _k - bvirt;
				bround = _0 - bvirt;
				around = _i - avirt;
				u[1] = around + bround;
				u3 = (double) (_j + _k);
				bvirt = u3 - _j;
				u[2] = _k - bvirt;
				u[3] = u3;
				finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
				finswap = finnow;
				finnow = finother;
				finother = finswap;
				if (adztail != 0.0) {
					c = (double) (splitter * adztail);
					abig = (double) (c - adztail);
					bhi = c - abig;
					blo = adztail - bhi;
					_i = (double) (bdxt_cdyt0 * adztail);
					c = (double) (splitter * bdxt_cdyt0);
					abig = (double) (c - bdxt_cdyt0);
					ahi = c - abig;
					alo = bdxt_cdyt0 - ahi;
					err1 = _i - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					u[0] = (alo * blo) - err3;
					_j = (double) (bdxt_cdyt1 * adztail);
					c = (double) (splitter * bdxt_cdyt1);
					abig = (double) (c - bdxt_cdyt1);
					ahi = c - abig;
					alo = bdxt_cdyt1 - ahi;
					err1 = _j - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					_0 = (alo * blo) - err3;
					_k = (double) (_i + _0);
					bvirt = (double) (_k - _i);
					avirt = _k - bvirt;
					bround = _0 - bvirt;
					around = _i - avirt;
					u[1] = around + bround;
					u3 = (double) (_j + _k);
					bvirt = u3 - _j;
					u[2] = _k - bvirt;
					u[3] = u3;
					finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
					finswap = finnow;
					finnow = finother;
					finother = finswap;
				}
			}
			if (adytail != 0.0) {
				negate = -bdxtail;
				bdxt_adyt1 = (double) (negate * adytail);
				c = (double) (splitter * negate);
				abig = (double) (c - negate);
				ahi = c - abig;
				alo = negate - ahi;
				c = (double) (splitter * adytail);
				abig = (double) (c - adytail);
				bhi = c - abig;
				blo = adytail - bhi;
				err1 = bdxt_adyt1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				bdxt_adyt0 = (alo * blo) - err3;
				c = (double) (splitter * cdz);
				abig = (double) (c - cdz);
				bhi = c - abig;
				blo = cdz - bhi;
				_i = (double) (bdxt_adyt0 * cdz);
				c = (double) (splitter * bdxt_adyt0);
				abig = (double) (c - bdxt_adyt0);
				ahi = c - abig;
				alo = bdxt_adyt0 - ahi;
				err1 = _i - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				u[0] = (alo * blo) - err3;
				_j = (double) (bdxt_adyt1 * cdz);
				c = (double) (splitter * bdxt_adyt1);
				abig = (double) (c - bdxt_adyt1);
				ahi = c - abig;
				alo = bdxt_adyt1 - ahi;
				err1 = _j - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				_0 = (alo * blo) - err3;
				_k = (double) (_i + _0);
				bvirt = (double) (_k - _i);
				avirt = _k - bvirt;
				bround = _0 - bvirt;
				around = _i - avirt;
				u[1] = around + bround;
				u3 = (double) (_j + _k);
				bvirt = u3 - _j;
				u[2] = _k - bvirt;
				u[3] = u3;
				finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
				finswap = finnow;
				finnow = finother;
				finother = finswap;
				if (cdztail != 0.0) {
					c = (double) (splitter * cdztail);
					abig = (double) (c - cdztail);
					bhi = c - abig;
					blo = cdztail - bhi;
					_i = (double) (bdxt_adyt0 * cdztail);
					c = (double) (splitter * bdxt_adyt0);
					abig = (double) (c - bdxt_adyt0);
					ahi = c - abig;
					alo = bdxt_adyt0 - ahi;
					err1 = _i - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					u[0] = (alo * blo) - err3;
					_j = (double) (bdxt_adyt1 * cdztail);
					c = (double) (splitter * bdxt_adyt1);
					abig = (double) (c - bdxt_adyt1);
					ahi = c - abig;
					alo = bdxt_adyt1 - ahi;
					err1 = _j - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					_0 = (alo * blo) - err3;
					_k = (double) (_i + _0);
					bvirt = (double) (_k - _i);
					avirt = _k - bvirt;
					bround = _0 - bvirt;
					around = _i - avirt;
					u[1] = around + bround;
					u3 = (double) (_j + _k);
					bvirt = u3 - _j;
					u[2] = _k - bvirt;
					u[3] = u3;
					finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
					finswap = finnow;
					finnow = finother;
					finother = finswap;
				}
			}
		}
		if (cdxtail != 0.0) {
			if (adytail != 0.0) {
				cdxt_adyt1 = (double) (cdxtail * adytail);
				c = (double) (splitter * cdxtail);
				abig = (double) (c - cdxtail);
				ahi = c - abig;
				alo = cdxtail - ahi;
				c = (double) (splitter * adytail);
				abig = (double) (c - adytail);
				bhi = c - abig;
				blo = adytail - bhi;
				err1 = cdxt_adyt1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				cdxt_adyt0 = (alo * blo) - err3;
				c = (double) (splitter * bdz);
				abig = (double) (c - bdz);
				bhi = c - abig;
				blo = bdz - bhi;
				_i = (double) (cdxt_adyt0 * bdz);
				c = (double) (splitter * cdxt_adyt0);
				abig = (double) (c - cdxt_adyt0);
				ahi = c - abig;
				alo = cdxt_adyt0 - ahi;
				err1 = _i - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				u[0] = (alo * blo) - err3;
				_j = (double) (cdxt_adyt1 * bdz);
				c = (double) (splitter * cdxt_adyt1);
				abig = (double) (c - cdxt_adyt1);
				ahi = c - abig;
				alo = cdxt_adyt1 - ahi;
				err1 = _j - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				_0 = (alo * blo) - err3;
				_k = (double) (_i + _0);
				bvirt = (double) (_k - _i);
				avirt = _k - bvirt;
				bround = _0 - bvirt;
				around = _i - avirt;
				u[1] = around + bround;
				u3 = (double) (_j + _k);
				bvirt = u3 - _j;
				u[2] = _k - bvirt;
				u[3] = u3;
				finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
				finswap = finnow;
				finnow = finother;
				finother = finswap;
				if (bdztail != 0.0) {
					c = (double) (splitter * bdztail);
					abig = (double) (c - bdztail);
					bhi = c - abig;
					blo = bdztail - bhi;
					_i = (double) (cdxt_adyt0 * bdztail);
					c = (double) (splitter * cdxt_adyt0);
					abig = (double) (c - cdxt_adyt0);
					ahi = c - abig;
					alo = cdxt_adyt0 - ahi;
					err1 = _i - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					u[0] = (alo * blo) - err3;
					_j = (double) (cdxt_adyt1 * bdztail);
					c = (double) (splitter * cdxt_adyt1);
					abig = (double) (c - cdxt_adyt1);
					ahi = c - abig;
					alo = cdxt_adyt1 - ahi;
					err1 = _j - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					_0 = (alo * blo) - err3;
					_k = (double) (_i + _0);
					bvirt = (double) (_k - _i);
					avirt = _k - bvirt;
					bround = _0 - bvirt;
					around = _i - avirt;
					u[1] = around + bround;
					u3 = (double) (_j + _k);
					bvirt = u3 - _j;
					u[2] = _k - bvirt;
					u[3] = u3;
					finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
					finswap = finnow;
					finnow = finother;
					finother = finswap;
				}
			}
			if (bdytail != 0.0) {
				negate = -cdxtail;
				cdxt_bdyt1 = (double) (negate * bdytail);
				c = (double) (splitter * negate);
				abig = (double) (c - negate);
				ahi = c - abig;
				alo = negate - ahi;
				c = (double) (splitter * bdytail);
				abig = (double) (c - bdytail);
				bhi = c - abig;
				blo = bdytail - bhi;
				err1 = cdxt_bdyt1 - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				cdxt_bdyt0 = (alo * blo) - err3;
				c = (double) (splitter * adz);
				abig = (double) (c - adz);
				bhi = c - abig;
				blo = adz - bhi;
				_i = (double) (cdxt_bdyt0 * adz);
				c = (double) (splitter * cdxt_bdyt0);
				abig = (double) (c - cdxt_bdyt0);
				ahi = c - abig;
				alo = cdxt_bdyt0 - ahi;
				err1 = _i - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				u[0] = (alo * blo) - err3;
				_j = (double) (cdxt_bdyt1 * adz);
				c = (double) (splitter * cdxt_bdyt1);
				abig = (double) (c - cdxt_bdyt1);
				ahi = c - abig;
				alo = cdxt_bdyt1 - ahi;
				err1 = _j - (ahi * bhi);
				err2 = err1 - (alo * bhi);
				err3 = err2 - (ahi * blo);
				_0 = (alo * blo) - err3;
				_k = (double) (_i + _0);
				bvirt = (double) (_k - _i);
				avirt = _k - bvirt;
				bround = _0 - bvirt;
				around = _i - avirt;
				u[1] = around + bround;
				u3 = (double) (_j + _k);
				bvirt = u3 - _j;
				u[2] = _k - bvirt;
				u[3] = u3;
				finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
				finswap = finnow;
				finnow = finother;
				finother = finswap;
				if (adztail != 0.0) {
					c = (double) (splitter * adztail);
					abig = (double) (c - adztail);
					bhi = c - abig;
					blo = adztail - bhi;
					_i = (double) (cdxt_bdyt0 * adztail);
					c = (double) (splitter * cdxt_bdyt0);
					abig = (double) (c - cdxt_bdyt0);
					ahi = c - abig;
					alo = cdxt_bdyt0 - ahi;
					err1 = _i - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					u[0] = (alo * blo) - err3;
					_j = (double) (cdxt_bdyt1 * adztail);
					c = (double) (splitter * cdxt_bdyt1);
					abig = (double) (c - cdxt_bdyt1);
					ahi = c - abig;
					alo = cdxt_bdyt1 - ahi;
					err1 = _j - (ahi * bhi);
					err2 = err1 - (alo * bhi);
					err3 = err2 - (ahi * blo);
					_0 = (alo * blo) - err3;
					_k = (double) (_i + _0);
					bvirt = (double) (_k - _i);
					avirt = _k - bvirt;
					bround = _0 - bvirt;
					around = _i - avirt;
					u[1] = around + bround;
					u3 = (double) (_j + _k);
					bvirt = u3 - _j;
					u[2] = _k - bvirt;
					u[3] = u3;
					finlength = fast_expansion_sum_zeroelim(finlength, finnow, 4, u, finother);
					finswap = finnow;
					finnow = finother;
					finother = finswap;
				}
			}
		}

		if (adztail != 0.0) {
			wlength = scale_expansion_zeroelim(bctlen, bct, adztail, w);
			finlength = fast_expansion_sum_zeroelim(finlength, finnow, wlength, w, finother);
			finswap = finnow;
			finnow = finother;
			finother = finswap;
		}
		if (bdztail != 0.0) {
			wlength = scale_expansion_zeroelim(catlen, cat, bdztail, w);
			finlength = fast_expansion_sum_zeroelim(finlength, finnow, wlength, w, finother);
			finswap = finnow;
			finnow = finother;
			finother = finswap;
		}
		if (cdztail != 0.0) {
			wlength = scale_expansion_zeroelim(abtlen, abt, cdztail, w);
			finlength = fast_expansion_sum_zeroelim(finlength, finnow, wlength, w, finother);
			finswap = finnow;
			finnow = finother;
			finother = finswap;
		}

		return finnow[finlength - 1];
	}

	static double orient3d(double[] pa, double[] pb, double[] pc, double[] pd) {
		double adx, bdx, cdx, ady, bdy, cdy, adz, bdz, cdz;
		double bdxcdy, cdxbdy, cdxady, adxcdy, adxbdy, bdxady;
		double det;
		double permanent, errbound;

		adx = pa[0] - pd[0];
		bdx = pb[0] - pd[0];
		cdx = pc[0] - pd[0];
		ady = pa[1] - pd[1];
		bdy = pb[1] - pd[1];
		cdy = pc[1] - pd[1];
		adz = pa[2] - pd[2];
		bdz = pb[2] - pd[2];
		cdz = pc[2] - pd[2];

		bdxcdy = bdx * cdy;
		cdxbdy = cdx * bdy;

		cdxady = cdx * ady;
		adxcdy = adx * cdy;

		adxbdy = adx * bdy;
		bdxady = bdx * ady;

		det = adz * (bdxcdy - cdxbdy) + bdz * (cdxady - adxcdy) + cdz * (adxbdy - bdxady);

		permanent = (((bdxcdy) >= 0.0 ? (bdxcdy) : -(bdxcdy)) + ((cdxbdy) >= 0.0 ? (cdxbdy) : -(cdxbdy))) * ((adz) >= 0.0 ? (adz) : -(adz))
				+ (((cdxady) >= 0.0 ? (cdxady) : -(cdxady)) + ((adxcdy) >= 0.0 ? (adxcdy) : -(adxcdy))) * ((bdz) >= 0.0 ? (bdz) : -(bdz))
				+ (((adxbdy) >= 0.0 ? (adxbdy) : -(adxbdy)) + ((bdxady) >= 0.0 ? (bdxady) : -(bdxady))) * ((cdz) >= 0.0 ? (cdz) : -(cdz));
		errbound = o3derrboundA * permanent;
		if ((det > errbound) || (-det > errbound)) {
//			System.out.println("Returning early "+det+" .. "+errbound);
			return det;
		}

		return orient3dadapt(pa, pb, pc, pd, permanent);
	}

	static double[] p0 = new double[3];
	static double[] p1 = new double[3];
	static double[] p2 = new double[3];
	static double[] p3 = new double[3];
	static double[] p4 = new double[3];

	// jdouble Java_Delaunay3D_Predicates_Primitives_orient3d(JNIEnv *, jobject,
	// jdouble x1, jdouble y1, jdouble z1, jdouble x2, jdouble y2, jdouble z2,
	// jdouble x3, jdouble y3, jdouble z3, jdouble x4, jdouble y4, jdouble z4){
	private static double orient3d(double x1, double y1, double z1, double x2, double y2, double z2, double x3, double y3, double z3, double x4, double y4,
			double z4) {
		p0[0] = x1;
		p0[1] = y1;
		p0[2] = z1;

		p1[0] = x2;
		p1[1] = y2;
		p1[2] = z2;

		p2[0] = x3;
		p2[1] = y3;
		p2[2] = z3;

		p3[0] = x4;
		p3[1] = y4;
		p3[2] = z4;

		return orient3d(p0, p1, p2, p3);
	}

}